<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    
    <title>Agehua</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="Agehua">
<meta property="og:url" content="http://agehua.github.io/page/3/index.html">
<meta property="og:site_name" content="Agehua">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Agehua">
    

    
        <link rel="alternate" href="/" title="Agehua" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Agehua</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">Agehua</h2>
            <h3 id="title">Android Developer &amp; Web Enthusiast</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Beijing, China</span>
            <a id="follow" target="_blank" href="https://github.com/agehua/">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                25
                <span>posts</span>
            </div>
            <div class="article-info-block">
                7
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/agehua" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-javaString-and-bytes" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/05/18/javaString-and-bytes/">Java String与C/C++中byte[]</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/05/18/javaString-and-bytes/">
            <time datetime="2016-05-17T16:00:00.000Z" itemprop="datePublished">2016-05-18</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/accumulation/">accumulation</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/accumulation/">accumulation</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>   做JAVA经常会碰到中文乱码问题，还有各种编码的问题，特别是String类的内容需要重新编码的问题。要解决这些问题，必须了解清楚JAVA对于字符串是怎么处理的。</p>
<h3 id="1，“字符”是由数字来表示的"><a href="#1，“字符”是由数字来表示的" class="headerlink" title="1，“字符”是由数字来表示的"></a>1，“字符”是由数字来表示的</h3><p>   先来重新了解一下计算机是如何处理“字符”的，这个原理是大家必须记住的，特别是在用JAVA写程序的时候，万万不可模糊。我们知道，<strong>计算机把任何东西都用数字来表示，“字符”也不例外</strong>。比如我们要显示一个阿拉伯数字“3”，在我们的PC里，其实并不是仅仅用一个数字3来代表我们要写的“3”，而是以十六进制的0x33来代表，包括放在内存或者是写到文件里，其实都是写着0x33的，不信你可以编辑一个文本文件，写一个“3”，然后用ultraEdit看他的原始码。</p>
<h3 id="2，一切“字符”都必定用数字-编码表表示。"><a href="#2，一切“字符”都必定用数字-编码表表示。" class="headerlink" title="2，一切“字符”都必定用数字+编码表表示。"></a>2，一切“字符”都必定用数字+编码表表示。</h3><p>   这时候，有一个问题：为什么一定要用0x33来代表“3”呢？而不用0x43来代表呢？或者是直接用0x03来代替？其实用什么来代表都可以，只不过大家都习惯了用ASCII编码表（是美国国家信息交换表）来确定各字符应该是用什么数字代表的。同样，为了表示中国字，我国也指定了中文的编码表，其中最广泛使用的是GB2312。比如中文的“当”字，就是用0xB5, 0xB1这两个八位的数字来表示的。所以 <strong>如果显示字符的程序不知道一列数字到底是按什么编码表编码的，他也无法去判断到底这些是什么文字</strong>。如果随便用一个不对的编码表来处理这些数字，处理出来的字符很可能完全是错的。比如在英文系统上，没有GB2312编码表，送给他一个0xB5,0xB1，他就傻傻的当作ASCII来处理（操作系统通常都有自己默认的编码表），结果显示出来就是两个奇怪的符号，因为这两个字在ASCII表里就是那两个符号。同样在繁体中文系统里，他的编码表是BIG5，显示出来也是一个奇怪的中文，不是“当”字。</p>
<h3 id="3，UNICODE让全世界都说一种语言"><a href="#3，UNICODE让全世界都说一种语言" class="headerlink" title="3，UNICODE让全世界都说一种语言"></a>3，UNICODE让全世界都说一种语言</h3><p>   看完上面的文字，是否觉得，世界有那么多语言，每个都有自己的一套编码表，很麻烦呢？就算是中文，也有两套流行的编码表，一个是GB2312，一个是BIG5。要使用不同中文的编码的字符时，还要转来转去，的确很麻烦。不光这个，如果想要写一篇包含很多过国文字的文章，就麻烦了，必须要让处理这个文章的程序知道，哪个字是什么编码标准的。如果你想要在文章里找一个字，也必须指定你要找的是哪种编码的哪个字。否则，你要找一个0xB5,0xB1的中文“当”字，很可能把同样数字表示的日文、波兰文这些不相干的字一起给你找出来，够麻烦的吧！<br>   所以人们想，不如大家都用同一个编码标准吧，各种文字都在编码表里有一席之地，处理文字的程序只需要都按这个编码表来处理就可以了。不过要一个编码表里包含所有的文字，这张表就大了，本来英文字+数字一共只有128个以内。但加上中文后，忽然就多了数万个，所以存放一个字符需要的大小也大了很多。现在 <strong>UNICODE规定了一个字符必须由2个8位数字来表示</strong>，想想，8x8x8x8x = 65536，是多大的一个数字啊！所以全世界的文字才能都包含进去。当然拉，也有人说中国字可能都不止6万个拉，还要包括别的文字，但人家外国人觉得你们中国人常用的也没那么多，所以就这么定了，我们也没办法。需要注意的是GB2312和UNICODE虽然都是用两个8位数来代表一个中文字，但具体的规格可不一样，比如0xB5,0xB1在UNICODE里面可不是“当”字，而是另外一国的文字来的。</p>
<h3 id="4，C是如何简洁的处理字符的"><a href="#4，C是如何简洁的处理字符的" class="headerlink" title="4，C是如何简洁的处理字符的"></a>4，C是如何简洁的处理字符的</h3><p>   我们来谈谈C的字符串。C语言诞生在JAVA之前，<strong>C语言的基本数据类型是没有字符串这个类型的，它只有char[]</strong>。也就是C把字符顺序放入一个字节数组就完了。而且C也不管放在数组里的是什么文字，也不管那些字是按什么编码标准的。而且他的char的大小也不一定是8位数字，有时候是16位也可能，<strong>这要看具体的机器和操作系统</strong>。所以写程序的人必须要知道正在处理的char[]的内容到底是按什么编码表表示的字符串，要知道如果比较两国文字是否相同，可是没任何意义的哦！</p>
<h3 id="5，JAVA是是如何处理字符的。"><a href="#5，JAVA是是如何处理字符的。" class="headerlink" title="5，JAVA是是如何处理字符的。"></a>5，JAVA是是如何处理字符的。</h3><p>   世界总会进步的，JAVA就是一个例子。JAVA终于有了String类了，它是解决字符问题的最好工具。在JAVA里，一个基本的要点是：<strong>String类对象是不需要指定编码表的！</strong> 为什么它会自己知道一堆数字各代表什么字符呢？就是因为 <strong>String里的字符信息是用UNICODE编码存放的</strong>。而JAVA为了表示字符（注意是单个字符），也有char这个数据类型，而且他的大小是固定2个8位16进制数字长度，也就是0~65535罗。为的就是对应UNICODE里面的一个字符。大家如果想取一个String里的按UNICODE数字，可以用getChars(int srcBegin, int srcEnd, char[] dst, int dstBegin) 方法取得一个char[]，这个char[]里就是表示String字符的，按UNICODE编码表编码的数字。</p>
<p>   可惜现在绝大多数的系统和程序都不是按UNICODE来处理字符，而JAVA程序总是要和别的程序和系统交换数据的，所以在接收一个字符，或者是发送一个字符的时候，就必须要留意当前系统和UNICODE的关系了。比如你从网络或者文件接受到一数字：0xB5,0xB1，JAVA程序并不知道这两个字到底是中文呢？还是日文，或者英文。你如果不指明这个两个数字的编码表，JAVA就会按当前系统默认的编码表来处理。如果这两个数字是从中文WIN98发出去的，JAVA程序又是在英文LINUX上运行的，那就出现了所谓的乱码问题了。也就是JAVA按英文的编码表ASCII来处理这两个数字，当通过new String({0xB5,0xB1})得到的String的时候，这个String代表的已经不是中文的“当”字，而是两个英文的奇怪字符了。不过如果你知道这两个数字一定是中文的话，就可以指定用new String({0xB5,0xB1},”GB2312”)来处理，这时候新建立的String才真的是一个“当”字。当然拉，如果你要把一个“当”字的JAVA的String显示在中文WIN98上，必须把这个字输出成两个8位数字：0xB5,0xB1，不管是写成文件还是输出到浏览器上，都必须是0xB5,0xB1。如何把“当”字用GB2312输出？<strong>String.getBytes(“GB2312”)</strong> 就可以拉！所以有一点要记住：<strong>和外界交换任何信息都是以byte[]来进行的！</strong>。你可以留意一下JAVA大多数的I/O类，都有以byte[]作为参数和返回值的方法。不过，也有很多写的比较糊涂的程序，没有提供byte[]交换信息的方法，害的不同文字平台的程序员很头疼。Servlet的HttpRequest.getParameter()就是这样。好在有的JSP/SERVLET容易还提供先指定编码表的方法，才能比较简单的解决这个问题。</p>
<h3 id="6，网上关于JAVA中文问题的一些错误处理方法。"><a href="#6，网上关于JAVA中文问题的一些错误处理方法。" class="headerlink" title="6，网上关于JAVA中文问题的一些错误处理方法。"></a>6，网上关于JAVA中文问题的一些错误处理方法。</h3><p>   一个是最常见的，不管什么内容，都用new String(…,”ISO-8859-1”)来建立字符串，然后使用的时候按默认的编码格式（通常在服务器上都是英文系统）输出字符串。这样其实你使用的String并不是按UNICODE来代表真正的字符，而是强行把BYTE数组复制到String的char[]里，一旦你的运行环境改变，你就被迫要修改一大堆的代码。而且也无法在同一个字符串里处理几种不同编码的文字。</p>
<p>   另一个是把一种编码格式的字符串，比如是GB2312，转换成另一种格式的字符串，比如UTF-8，然后不指明是UTF-8编码，而直接用new String(…)来建立String，这样放在String里面的字符也是无法确定的，它在不同的系统上代表不同的字符。如果要求别人用“UTF-8格式”的String来交换信息的时候，其实已经破坏了JAVA为了兼容各种语言所做的规定。这种错误的本质思想是还按写C语言的方式，把字符串纯粹当作可以自己自由编码的存储器使用，而忽略了JAVA字符串只有一种编码格式。如果真的想自由编码，用byte[]或者char[]就完全了解决问题的了。</p>
<h3 id="7，其他资料"><a href="#7，其他资料" class="headerlink" title="7，其他资料"></a>7，其他资料</h3><p><a href="http://www.regexlab.com/zh/encoding.htm" target="_blank" rel="external">字符，字节和编码</a></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://agehua.github.io/2016/05/18/javaString-and-bytes/" data-id="ciw6b0aki000mi6fyre5vvu9j" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://agehua.github.io/2016/05/18/javaString-and-bytes/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://agehua.github.io/2016/05/18/javaString-and-bytes/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-GCM-Azure_summary" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/05/12/GCM-Azure_summary/">google cloud message（GCM）和Azure实现Notification总结</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/05/12/GCM-Azure_summary/">
            <time datetime="2016-05-11T16:00:00.000Z" itemprop="datePublished">2016-05-12</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/accumulation/">accumulation</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/accumulation/">accumulation</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="1-相关资料"><a href="#1-相关资料" class="headerlink" title="1.相关资料"></a>1.相关资料</h3><p>我也是一知半解，基本上就是根据官方教程来实现，但microsoft的azure文档我找了好久，英文不好，汗。。。</p>
<p>gcm start: <a href="https://developers.google.com/cloud-messaging/android/start" target="_blank" rel="external">https://developers.google.com/cloud-messaging/android/start</a></p>
<p>azure start: <a href="https://azure.microsoft.com/zh-cn/documentation/articles/notification-hubs-android-get-started/" target="_blank" rel="external">https://azure.microsoft.com/zh-cn/documentation/articles/notification-hubs-android-get-started/</a></p>
<p>gcm official demo: <a href="https://github.com/google/gcm" target="_blank" rel="external">https://github.com/google/gcm</a></p>
<p>gcm personal demo: <a href="https://github.com/iammert/FastGCM" target="_blank" rel="external">https://github.com/iammert/FastGCM</a></p>
<h3 id="2-遇到的问题"><a href="#2-遇到的问题" class="headerlink" title="2.遇到的问题"></a>2.遇到的问题</h3><ul>
<li>1.手机运行官方demo时，发送消息，消息收不到必须切换一下网络才可以</li>
</ul>
<p>stackoverflow上有人问过这个问题：<a href="http://stackoverflow.com/questions/13835676/google-cloud-messaging-messages-sometimes-not-received-until-network-state-cha" target="_blank" rel="external">http://stackoverflow.com/questions/13835676/google-cloud-messaging-messages-sometimes-not-received-until-network-state-cha</a></p>
<h3 id="3-onActivityResult-和onResume-调用顺序"><a href="#3-onActivityResult-和onResume-调用顺序" class="headerlink" title="3.onActivityResult()和onResume()调用顺序"></a>3.onActivityResult()和onResume()调用顺序</h3><p>API中这样描述：当你一个Activity是以请求码开始，结束时返回给前页面结果码，页面根据结果码进行相应的信息处理。我们会在返回的页面先接受结果码，然后才调用onResume()。</p>
<p>通常我们还会遇到这样一个问题：<br>在处理返回页面的数据问题<br>1.需要从服务器上刷新数据时我们会在onResume()方法里处理<br>2.而刷新从结束界面返回的数据我们会在onAcitviyResult()方法里面处理</p>
<p>为了避免二者在同一块控件上对数据处理，我们只需加个标识符，在两个方法里进行判断，要用哪个方法进行刷新</p>
<h3 id="4-Android4-4以上系统根据Uri正确获取文件路径的方法"><a href="#4-Android4-4以上系统根据Uri正确获取文件路径的方法" class="headerlink" title="4.Android4.4以上系统根据Uri正确获取文件路径的方法"></a>4.Android4.4以上系统根据Uri正确获取文件路径的方法</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPhotoPathFromContentUri</span><span class="params">(Context context, Uri uri)</span> </span>&#123;</div><div class="line">    String photoPath = <span class="string">""</span>;</div><div class="line">    <span class="keyword">if</span>(context == <span class="keyword">null</span> || uri == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> photoPath;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT &amp;&amp; DocumentsContract.isDocumentUri(context, uri)) &#123;</div><div class="line">        String docId = DocumentsContract.getDocumentId(uri);</div><div class="line">        <span class="keyword">if</span>(isExternalStorageDocument(uri)) &#123;</div><div class="line">            String [] split = docId.split(<span class="string">":"</span>);</div><div class="line">            <span class="keyword">if</span>(split.length &gt;= <span class="number">2</span>) &#123;</div><div class="line">                String type = split[<span class="number">0</span>];</div><div class="line">                <span class="keyword">if</span>(<span class="string">"primary"</span>.equalsIgnoreCase(type)) &#123;</div><div class="line">                    photoPath = Environment.getExternalStorageDirectory() + <span class="string">"/"</span> + split[<span class="number">1</span>];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(isDownloadsDocument(uri)) &#123;</div><div class="line">            Uri contentUri = ContentUris.withAppendedId(Uri.parse(<span class="string">"content://downloads/public_downloads"</span>), Long.valueOf(docId));</div><div class="line">            photoPath = getDataColumn(context, contentUri, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(isMediaDocument(uri)) &#123;</div><div class="line">            String[] split = docId.split(<span class="string">":"</span>);</div><div class="line">            <span class="keyword">if</span>(split.length &gt;= <span class="number">2</span>) &#123;</div><div class="line">                String type = split[<span class="number">0</span>];</div><div class="line">                Uri contentUris = <span class="keyword">null</span>;</div><div class="line">                <span class="keyword">if</span>(<span class="string">"image"</span>.equals(type)) &#123;</div><div class="line">                    contentUris = MediaStore.Images.Media.EXTERNAL_CONTENT_URI;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"video"</span>.equals(type)) &#123;</div><div class="line">                    contentUris = MediaStore.Video.Media.EXTERNAL_CONTENT_URI;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"audio"</span>.equals(type)) &#123;</div><div class="line">                    contentUris = MediaStore.Audio.Media.EXTERNAL_CONTENT_URI;</div><div class="line">                &#125;</div><div class="line">                String selection = MediaStore.Images.Media._ID + <span class="string">"=?"</span>;</div><div class="line">                String[] selectionArgs = <span class="keyword">new</span> String[] &#123; split[<span class="number">1</span>] &#125;;</div><div class="line">                photoPath = getDataColumn(context, contentUris, selection, selectionArgs);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"file"</span>.equalsIgnoreCase(uri.getScheme())) &#123;</div><div class="line">        photoPath = uri.getPath();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        photoPath = getDataColumn(context, uri, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> photoPath;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isExternalStorageDocument</span><span class="params">(Uri uri)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"com.android.externalstorage.documents"</span>.equals(uri.getAuthority());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isDownloadsDocument</span><span class="params">(Uri uri)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"com.android.providers.downloads.documents"</span>.equals(uri.getAuthority());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMediaDocument</span><span class="params">(Uri uri)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"com.android.providers.media.documents"</span>.equals(uri.getAuthority());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getDataColumn</span><span class="params">(Context context, Uri uri, String selection, String[] selectionArgs)</span> </span>&#123;</div><div class="line">    Cursor cursor = <span class="keyword">null</span>;</div><div class="line">    String column = MediaStore.Images.Media.DATA;</div><div class="line">    String[] projection = &#123; column &#125;;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        cursor = context.getContentResolver().query(uri, projection, selection, selectionArgs, <span class="keyword">null</span>);</div><div class="line">        <span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; cursor.moveToFirst()) &#123;</div><div class="line">            <span class="keyword">int</span> index = cursor.getColumnIndexOrThrow(column);</div><div class="line">            <span class="keyword">return</span> cursor.getString(index);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        <span class="keyword">if</span> (cursor != <span class="keyword">null</span> &amp;&amp; !cursor.isClosed())</div><div class="line">                cursor.close();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://agehua.github.io/2016/05/12/GCM-Azure_summary/" data-id="ciw6b0ake000hi6fy8n6uet6x" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://agehua.github.io/2016/05/12/GCM-Azure_summary/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://agehua.github.io/2016/05/12/GCM-Azure_summary/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android-books-reading-" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/03/20/android-books-reading-/">《android开发艺术探索》读书笔记</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/03/20/android-books-reading-/">
            <time datetime="2016-03-19T16:00:00.000Z" itemprop="datePublished">2016-03-20</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/read/">read</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/read/">read</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="第1章-Activity的生命周期和启动模式"><a href="#第1章-Activity的生命周期和启动模式" class="headerlink" title="第1章 Activity的生命周期和启动模式"></a>第1章 Activity的生命周期和启动模式</h3><p>本节和《Android群英传》中的第8章Activity和Activity调用栈分析有关系，建议先阅读该章的总结</p>
<p>第1章 Activity的生命周期和启动模式</p>
<h4 id="1-1-Activity生命周期全面分析"><a href="#1-1-Activity生命周期全面分析" class="headerlink" title="1.1 Activity生命周期全面分析"></a>1.1 Activity生命周期全面分析</h4><h5 id="1-1-1-典型情况下生命周期分析"><a href="#1-1-1-典型情况下生命周期分析" class="headerlink" title="1.1.1 典型情况下生命周期分析"></a>1.1.1 典型情况下生命周期分析</h5><ul>
<li><p>(1)一般情况下，当当前Activity从不可见重新变为可见状态时，onRestart方法就会被调用。</p>
</li>
<li><p>(2)当用户打开新的Activity或者切换到桌面的时候，回调如下：onPause -&gt; onStop，但是如果新Activity采用了透明主题，那么onStop方法不会被回调。当用户再次回到原来的Activity时，回调如下：onRestart -&gt; onStart -&gt; onResume。</p>
</li>
<li><p>(3)onStart和onStop对应，它们是从Activity是否可见这个角度来回调的；onPause和onResume方法对应，它们是从Activity是否位于前台这个角度来回调的。</p>
</li>
<li><p>(4)从Activity A进入到Activity B，回调顺序是onPause(A) -&gt; onCreate(B) -&gt; onStart(B) -&gt; onResume(B) -&gt; onStop(A)，所以不能在onPause方法中做重量级的操作。</p>
</li>
</ul>
<p>1.1.2 异常情况下生命周期分析</p>
<ul>
<li><p>(1)onSaveInstanceState方法只会出现在Activity被异常终止的情况下，它的调用时机是在onStop之前，它和onPause方法没有既定的时序关系，可能在它之前，也可能在它之后。</p>
<p>  当Activity被重新创建的时候，onRestoreInstanceState会被回调，它的调用时机是onStart之后。</p>
<p>  系统只会在Activity即将被销毁并且有机会重新显示的情况下才会去调用onSaveInstanceState方法。</p>
<p>  当Activity在异常情况下需要重新创建时，系统会默认为我们保存当前Activity的视图结构，并且在Activity重启后为我们恢复这些数据，比如文本框中用户输入的数据、listview滚动的位置等，这些view相关的状态系统都会默认为我们恢复。具体针对某一个view系统能为我们恢复哪些数据可以查看view的源码中的onSaveInstanceState和onRestoreInstanceState方法。</p>
</li>
<li><p>(2)Activity按优先级的分类</p>
<p>  前台Activity；可见但非前台Activity；后台Activity</p>
</li>
<li><p>(3)android:configChanges=”xxx”属性，常用的主要有下面三个选项：</p>
<p>  local：设备的本地位置发生了变化，一般指切换了系统语言；</p>
<p>  keyboardHidden：键盘的可访问性发生了变化，比如用户调出了键盘；</p>
<p>  orientation：屏幕方向发生了变化，比如旋转了手机屏幕。</p>
<p>  配置了android:configChanges=”xxx”属性之后，Activity就不会在对应变化发生时重新创建，而是调用Activity的onConfigurationChanged方法。</p>
</li>
</ul>
<h4 id="1-2-Activity的启动模式"><a href="#1-2-Activity的启动模式" class="headerlink" title="1.2 Activity的启动模式"></a>1.2 Activity的启动模式</h4><h5 id="1-2-1-启动模式"><a href="#1-2-1-启动模式" class="headerlink" title="1.2.1 启动模式"></a>1.2.1 启动模式</h5><ul>
<li><p>(1)当任务栈中没有任何Activity的时候，系统就会回收这个任务栈。</p>
</li>
<li><p>(2)从非Activity类型的Context(例如ApplicationContext、Service等)中以standard模式启动新的Activity是不行的，因为这类context并没有任务栈，所以需要为待启动Activity指定FLAG_ACTIVITY_NEW_TASK标志位。</p>
</li>
<li><p>(3)任务栈分为前台任务栈和后台任务栈，后台任务栈中的Activity位于暂停状态，用户可以通过切换将后台任务栈再次调到前台。</p>
</li>
<li><p>(4)参数TaskAffinity用来指定Activity所需要的任务栈，意为任务相关性。</p>
<p>  默认情况下，所有Activity所需的任务栈的名字为应用的包名。TaskAffinity属性主要和singleTask启动模式或者allowTaskReparenting属性配对使用，在其他情况下没有意义。</p>
<p>  当TaskAffinity和singleTask启动模式配对使用的时候，它是具有该模式的Activity的目前任务栈的名字，待启动的Activity会运行在名字和TaskAffinity相同的任务栈中；</p>
<p>  当TaskAffinity和allowTaskReparenting结合的时候，当一个应用A启动了应用B的某个Activity C后，如果Activity C的allowTaskReparenting属性设置为true的话，那么当应用B被启动后，系统会发现Activity C所需的任务栈存在了，就将Activity C从A的任务栈中转移到B的任务栈中。</p>
</li>
<li><p>(5)singleTask模式的具体分析：</p>
<p>  当一个具有singleTask启动模式的Activity请求启动之后，系统首先会寻找是否存在A想要的任务栈，</p>
<p>  如果不存在，就重新创建一个任务栈，然后创建Activity的实例把它放到栈中；如果存在Activity所需的任务栈，这时候要看栈中是否有Activity实例存在.</p>
<p>  如果有，那么系统就会把该Activity实例调到栈顶，并调用它的onNewIntent方法(它之上的Activity会被迫出栈，所以singleTask模式具有FLAG_ACTIVITY_CLEAR_TOP效果)；如果Activity实例不存在，那么就创建Activity实例并把它压入栈中。</p>
</li>
<li><p>(6)设置启动模式既可以使用xml属性android:launchMode，也可以使用代码intent.addFlags()。区别在于限定范围不同，前者无法直接为Activity设置FLAG_ACTIVITY_CLEAR_TOP标识，而后者无法为Activity指定singleInstance模式。</p>
</li>
</ul>
<h5 id="1-2-2-Activity的Flags"><a href="#1-2-2-Activity的Flags" class="headerlink" title="1.2.2 Activity的Flags"></a>1.2.2 Activity的Flags</h5><p>FLAG_ACTIVITY_NEW_TASK,FLAG_ACTIVITY_SINGLE_TOP,FLAG_ACTIVITY_CLEAR_TOP</p>
<p>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS：具有这个标记的Activity不会出现在历史Activity列表中，当某些情况下我们不希望用户通过历史列表回到我们的Activity的时候这个标记比较有用，它等同于属性设置android:excludeFromRecents=”true”。</p>
<h4 id="1-3-IntentFilter的匹配规则"><a href="#1-3-IntentFilter的匹配规则" class="headerlink" title="1.3 IntentFilter的匹配规则"></a>1.3 IntentFilter的匹配规则</h4><ul>
<li><p>(1)IntentFilter中的过滤信息有action、category、data，为了匹配过滤列表，需要同时匹配过滤列表中的action、category、data信息，否则匹配失败。</p>
<p>  一个过滤列表中的action、category、data可以有多个，所有的action、category、data分别构成不同类别，同一类别的信息共同约束当前类别的匹配过程。只有一个Intent同时匹配action类别、category类别和data类别才算完全匹配，只有完全匹配才能成功启动目标Activity。此外，一个Activity中可以有多个intent-filter，一个Intent只要能匹配任何一组intenf-filter即可成功启动对应的Activity。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">&lt;intent-filter&gt;</div><div class="line">    &lt;action android:name="com.ryg.charpter_1.c" /&gt;</div><div class="line">    &lt;action android:name="com.ryg.charpter_1.d" /&gt;</div><div class="line"></div><div class="line">    &lt;category android:name="com.ryg.category.c" /&gt;</div><div class="line">    &lt;category android:name="com.ryg.category.d" /&gt;</div><div class="line">    &lt;category android:name="android.intent.category.DEFAULT" /&gt;</div><div class="line"></div><div class="line">    &lt;data android:mimeType="text/plain" /&gt;</div><div class="line">&lt;/intent-filter&gt;</div><div class="line">~~~  </div><div class="line"></div><div class="line">- (2)action匹配规则</div><div class="line"></div><div class="line">    只要Intent中的action能够和过滤规则中的任何一个action相同即可匹配成功，action匹配区分大小写。</div><div class="line"></div><div class="line">- (3)category匹配规则</div><div class="line"></div><div class="line">    Intent中如果有category那么所有的category都必须和过滤规则中的其中一个category相同，如果没有category的话那么就是默认的category，即android.intent.category.DEFAULT，所以为了Activity能够接收隐式调用，配置多个category的时候必须加上默认的category。</div><div class="line"></div><div class="line">- (4)data匹配规则</div><div class="line"></div><div class="line">    data的结构很复杂，语法大致如下：</div><div class="line">~~~ Javascript</div><div class="line">&lt;data android:scheme="string"</div><div class="line">	android:host="string"</div><div class="line">	android:port="string"</div><div class="line">	android:path="string"`</div><div class="line">	android:pathPattern="string"</div><div class="line">	android:pathPrefix="string"</div><div class="line">	android:mimeType="string" /&gt;</div></pre></td></tr></table></figure>
<p>  主要由mimeType和URI组成，其中mimeType代表媒体类型，而URI的结构也复杂，大致如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">&lt;scheme&gt;:<span class="comment">//&lt;host&gt;:&lt;port&gt;/[&lt;path&gt;]|[&lt;pathPrefix&gt;]|[pathPattern]</span></div></pre></td></tr></table></figure>
<p>  例如content://com.example.project:200/folder/subfolder/etc</p>
<ul>
<li><p>scheme、host、port分别表示URI的模式、主机名和端口号，其中如果scheme或者host未指定那么URI就无效。</p>
</li>
<li><p>path、pathPattern、pathPrefix都是表示路径信息，其中path表示完整的路径信息，pathPrefix表示路径的前缀信息；pathPattern表示完整的路径，但是它里面包含了通配符(*)。</p>
</li>
</ul>
<p>data匹配规则：Intent中必须含有data数据，并且data数据能够完全匹配过滤规则中的某一个data。</p>
<p>URI有默认的scheme！</p>
<p>如果过滤规则中的mimeType指定为image/*或者text/*等这种类型的话，那么即使过滤规则中没有指定URI，URI有默认的scheme是content和file！如果过滤规则中指定了scheme的话那就不是默认的scheme了。</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">//URI有默认值</div><div class="line">&lt;intent-filter&gt;</div><div class="line">    &lt;data android:mimeType="image/*"/&gt;</div><div class="line">  ...</div><div class="line">&lt;/intent-filter&gt;</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">//URI默认值被覆盖</div><div class="line">&lt;intent-filter&gt;</div><div class="line">    &lt;data android:mimeType="image/*" android:scheme="http" .../&gt;</div><div class="line">    ...</div><div class="line">&lt;/intent-filter&gt;</div></pre></td></tr></table></figure>
<p>  如果要为Intent指定完整的data，必须要调用setDataAndType方法！</p>
<p>  不能先调用setData然后调用setType，因为这两个方法会彼此清除对方的值。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">intent.setDataAndType(Uri.parse(<span class="string">"file://abc"</span>), <span class="string">"image/png"</span>);</div></pre></td></tr></table></figure></p>
<p>  data的下面两种写法作用是一样的：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">&lt;intent-filter&gt;</div><div class="line">    &lt;data android:scheme="file" android:host="www.github.com"/&gt;</div><div class="line">&lt;/intent-filter&gt;</div><div class="line"></div><div class="line">&lt;intent-filter&gt;</div><div class="line">    &lt;data android:scheme="file"/&gt;</div><div class="line">    &lt;data android:host="www.github.com"/&gt;</div><div class="line">&lt;/intent-filter&gt;</div></pre></td></tr></table></figure>
<p>  如何判断是否有Activity能够匹配我们的隐式Intent？</p>
<ul>
<li><p>(1)PackageManager的resolveActivity方法或者Intent的resolveActivity方法：如果找不到就会返回null</p>
</li>
<li><p>(2)PackageManager的queryIntentActivities方法：它返回所有成功匹配的Activity信息<br>针对Service和BroadcastReceiver等组件，PackageManager同样提供了类似的方法去获取成功匹配的组件信息，例如queryIntentServices、queryBroadcastReceivers等方法</p>
</li>
<li><p>有一类action和category比较重要，它们在一起用来标明这是一个入口Activity，并且会出现在系统的应用列表中。</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">&lt;intent-filter&gt;</div><div class="line">    &lt;action android:name="android.intent.action.MAIN" /&gt;</div><div class="line">    &lt;category android:name="android.intent.category.LAUNCHER" /&gt;</div><div class="line">&lt;/intent-filter&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="第2章-IPC机制"><a href="#第2章-IPC机制" class="headerlink" title="第2章 IPC机制"></a>第2章 IPC机制</h3><h4 id="2-1-Android-IPC简介"><a href="#2-1-Android-IPC简介" class="headerlink" title="2.1 Android IPC简介"></a>2.1 Android IPC简介</h4><p>(1)任何一个操作系统都需要有相应的IPC机制，Linux上可以通过命名通道、共享内存、信号量等来进行进程间通信。Android系统不仅可以使用了Binder机制来实现IPC，还可以使用Socket实现任意两个终端之间的通信。</p>
<h4 id="2-2-Android中的多进程模式"><a href="#2-2-Android中的多进程模式" class="headerlink" title="2.2 Android中的多进程模式"></a>2.2 Android中的多进程模式</h4><ul>
<li><p>(1)通过给四大组件指定android:process属性就可以开启多进程模式.</p>
<p>  默认进程的进程名是包名packageName，进程名以:开头的进程属于当前应用的私有进程，其他应用的组件不可以和它跑在同一个进程中，而进程名不以:开头的进程属于全局进程，其他应用通过ShareUID方法可以和它跑在同一个进程中。</p>
<p>  android:process=”:xyz” //进程名是 packageName:xyz</p>
<p>  android:process=”aaa.bbb.ccc” //进程名是 aaa.bbb.ccc</p>
</li>
<li><p>(2)Android系统会为每个应用分配一个唯一的UID，具有相同UID的应用才能共享数据。</p>
<p>  两个应用通过ShareUID跑在同一个进程中是有要求的，需要这两个应用有相同的ShareUID并且签名相同才可以。 在这种情况下，它们可以相互访问对方的私有数据，比如data目录、组件信息等，不管它们是否跑在同一个进程中。如果它们跑在同一个进程中，还可以共享内存数据，它们看起来就像是一个应用的两个部分。</p>
</li>
<li><p>(3)android系统会为每个进程分配一个独立的虚拟机，不同的虚拟机在内存分配上有不同的地址空间，所以不同的虚拟机中访问同一个类的对象会产生多个副本。</p>
</li>
<li><p>(4)使用多进程容易造成以下几个问题：</p>
<ul>
<li>1.静态成员和单例模式完全失效；</li>
<li>2.线程同步机制完全失效：无论锁对象还是锁全局对象都无法保证线程同步；</li>
<li>3.SharedPreferences的可靠性下降：SharedPreferences不支持并发读写；</li>
<li><p>4.Application会多次创建：当一个组件跑在一个新的进程的时候，系统要在创建新的进程的同时分配独立的虚拟机，应用会重新启动一次，也就会创建新的Application。运行在同一个进程中的组件是属于同一个虚拟机和同一个Application。</p>
<p>同一个应用的不同组件，如果它们运行在不同进程中，那么和它们分别属于两个应用没有本质区别。</p>
</li>
</ul>
</li>
</ul>
<h4 id="2-3-IPC基础概念介绍"><a href="#2-3-IPC基础概念介绍" class="headerlink" title="2.3 IPC基础概念介绍"></a>2.3 IPC基础概念介绍</h4><ul>
<li><p>(1)Serializable接口是Java中为对象提供标准的序列化和反序列化操作的接口，而Parcelable接口是Android提供的序列化方式的接口。</p>
</li>
<li><p>(2)serialVersionUId是一串long型数字，主要是用来辅助序列化和反序列化的，原则上序列化后的数据中的serialVersionUId只有和当前类的serialVersionUId相同才能够正常地被反序列化。</p>
<p>serialVersionUId的详细工作机制：序列化的时候系统会把当前类的serialVersionUId写入序列化的文件中，当反序列化的时候系统会去检测文件中的serialVersionUId，看它是否和当前类的serialVersionUId一致，如果一致就说明序列化的类的版本和当前类的版本是相同的，这个时候可以成功反序列化；否则说明版本不一致无法正常反序列化。一般来说，我们应该手动指定serialVersionUId的值。</p>
<ul>
<li><p>1.静态成员变量属于类不属于对象，所以不参与序列化过程；</p>
</li>
<li><p>2.声明为transient的成员变量不参与序列化过程。</p>
</li>
</ul>
</li>
<li><p>(3)Parcelable接口内部包装了可序列化的数据，可以在Binder中自由传输，Parcelable主要用在内存序列化上，可以直接序列化的有Intent、Bundle、Bitmap以及List和Map等等，下面是一个实现了Parcelable接口的示例</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> bookId;</div><div class="line">    <span class="keyword">public</span> String bookName;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(<span class="keyword">int</span> bookId, String bookName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.bookId = bookId;</div><div class="line">        <span class="keyword">this</span>.bookName = bookName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//“内容描述”，如果含有文件描述符返回1，否则返回0，几乎所有情况下都是返回0</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//实现序列化操作，flags标识只有0和1，1表示标识当前对象需要作为返回值返回，不能立即释放资源，几乎所有情况都为0</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel out, <span class="keyword">int</span> flags)</span> </span>&#123;</div><div class="line">        out.writeInt(bookId);</div><div class="line">        out.writeString(bookName);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//实现反序列化操作</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Parcelable.Creator&lt;Book&gt; CREATOR = <span class="keyword">new</span> Parcelable.Creator&lt;Book&gt;() &#123;</div><div class="line">        <span class="comment">//从序列化后的对象中创建原始对象</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Book <span class="title">createFromParcel</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Book(in);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">public</span> Book[] newArray(<span class="keyword">int</span> size) &#123;<span class="comment">//创建指定长度的原始对象数组</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Book[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Book</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">        bookId = in.readInt();</div><div class="line">        bookName = in.readString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>(4)Binder是Android中的一个类，它实现了IBinder接口。</p>
<p>从IPC角度看，Binder是Android中一种跨进程通信的方式；Binder还可以理解为虚拟的物理设备，它的设备驱动是/dev/binder；</p>
<p>从Framework层角度看，Binder是ServiceManager连接各种Manager和相应的ManagerService的桥梁；</p>
<p>从Android应用层来说，Binder是客户端和服务端进行通信的媒介，当bindService的时候，服务端会返回一个包含了服务端业务调用的Binder对象，通过这个Binder对象，客户端就可以获取服务端提供的服务或者数据，这里的服务包括普通服务和基于AIDL的服务。</p>
</li>
</ul>
<p>  在Android开发中，Binder主要用在Service中，包括AIDL和Messenger，其中普通Service中的Binder不涉及进程间通信，较为简单；而Messenger的底层其实是AIDL，正是Binder的核心工作机制。</p>
<ul>
<li><p>(5)aidl工具根据aidl文件自动生成的java接口的解析：</p>
<p>首先，它声明了几个接口方法，同时还声明了几个整型的id用于标识这些方法，id用于标识在transact过程中客户端所请求的到底是哪个方法；</p>
<p>接着，它声明了一个内部类Stub，这个Stub就是一个Binder类，当客户端和服务端都位于同一个进程时，方法调用不会走跨进程的transact过程，而当两者位于不同进程时，方法调用需要走transact过程，这个逻辑由Stub内部的代理类Proxy来完成。</p>
<p>所以，这个接口的核心就是它的内部类Stub和Stub内部的代理类Proxy。 下面分析其中的方法：</p>
<ul>
<li>1.asInterface(android.os.IBinder obj)：用于将服务端的Binder对象转换成客户端所需的AIDL接口类型的对象，这种转换过程是区分进程的，如果客户端和服务端是在同一个进程中，那么这个方法返回的是服务端的Stub对象本身，否则返回的是系统封装的Stub.Proxy对象。</li>
<li>2.asBinder：返回当前Binder对象。</li>
<li><p>3.onTransact：这个方法运行在服务端中的Binder线程池中，当客户端发起跨进程请求时，远程请求会通过系统底层封装后交由此方法来处理。</p>
<p>这个方法的原型是public Boolean onTransact(int code, Parcelable data, Parcelable reply, int flags)</p>
<p>服务端通过code可以知道客户端请求的目标方法，接着从data中取出所需的参数，然后执行目标方法，执行完毕之后，将结果写入到reply中。如果此方法返回false，说明客户端的请求失败，利用这个特性可以做权限验证(即验证是否有权限调用该服务)。</p>
</li>
<li><p>4.Proxy#[Method]：代理类中的接口方法，这些方法运行在客户端，当客户端远程调用此方法时，它的内部实现是：</p>
<p>首先创建该方法所需要的参数，然后把方法的参数信息写入到_data中，接着调用transact方法来发起RPC请求，同时当前线程挂起；然后服务端的onTransact方法会被调用，直到RPC过程返回后，当前线程继续执行，并从_reply中取出RPC过程的返回结果，最后返回_reply中的数据。</p>
</li>
</ul>
<p>如果搞清楚了自动生成的接口文件的结构和作用之后，其实是可以不用通过AIDL而直接实现Binder的，<a href="https://github.com/singwhatiwanna/android-art-res/blob/master/Chapter_2/src/com/ryg/chapter_2/manualbinder/BookManagerImpl.java" target="_blank" rel="external">主席写的示例代码</a></p>
</li>
<li><p>(6)Binder的两个重要方法linkToDeath和unlinkToDeath</p>
<p>Binder运行在服务端，如果由于某种原因服务端异常终止了的话会导致客户端的远程调用失败，所以Binder提供了两个配对的方法linkToDeath和unlinkToDeath，通过linkToDeath方法可以给Binder设置一个死亡代理，当Binder死亡的时候客户端就会收到通知，然后就可以重新发起连接请求从而恢复连接了。</p>
<p>如何给Binder设置死亡代理呢？</p>
<ul>
<li>1.声明一个DeathRecipient对象，DeathRecipient是一个接口，其内部只有一个方法bindeDied，实现这个方法就可以在Binder死亡的时候收到通知了。</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">private</span> IBinder.DeathRecipient mDeathRecipient = <span class="keyword">new</span> IBinder.DeathRecipient() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">binderDied</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mRemoteBookManager == <span class="keyword">null</span>) <span class="keyword">return</span>;</div><div class="line">        mRemoteBookManager.asBinder().unlinkToDeath(mDeathRecipient, <span class="number">0</span>);</div><div class="line">        mRemoteBookManager = <span class="keyword">null</span>;</div><div class="line">        <span class="comment">// <span class="doctag">TODO:</span>这里重新绑定远程Service</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>2.在客户端绑定远程服务成功之后，给binder设置死亡代理</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">mRemoteBookManager.asBinder().linkToDeath(mDeathRecipient, <span class="number">0</span>);</div></pre></td></tr></table></figure>
<h4 id="2-4-Android中的IPC方式"><a href="#2-4-Android中的IPC方式" class="headerlink" title="2.4 Android中的IPC方式"></a>2.4 Android中的IPC方式</h4><ul>
<li><p>(1)使用Bundle：Bundle实现了Parcelable接口，Activity、Service和Receiver都支持在Intent中传递Bundle数据。</p>
</li>
<li><p>(2)使用文件共享：这种方式简单，适合在对数据同步要求不高的进程之间进行通信，并且要妥善处理并发读写的问题。</p>
<p>SharedPreferences是一个特例，虽然它也是文件的一种，但是由于系统对它的读写有一定的缓存策略，即在内存中会有一份SharedPreferences文件的缓存，因此在多进程模式下，系统对它的读写就变得不可靠，当面对高并发读写访问的时候，有很大几率会丢失数据，因此，不建议在进程间通信中使用SharedPreferences。</p>
</li>
<li><p>(3)使用Messenger：Messenger是一种轻量级的IPC方案，它的底层实现就是AIDL。Messenger是以串行的方式处理请求的，即服务端只能一个个处理，不存在并发执行的情形，详细的示例见原书。</p>
</li>
<li><p>(4)使用AIDL</p>
<p>大致流程：首先建一个Service和一个AIDL接口，接着创建一个类继承自AIDL接口中的Stub类并实现Stub类中的抽象方法，在Service的onBind方法中返回这个类的对象，然后客户端就可以绑定服务端Service，建立连接后就可以访问远程服务端的方法了。</p>
<ul>
<li>1.AIDL支持的数据类型：基本数据类型、String和CharSequence、ArrayList、HashMap、Parcelable以及AIDL；</li>
<li>2.某些类即使和AIDL文件在同一个包中也要显式import进来；</li>
<li>3.AIDL中除了基本数据类，其他类型的参数都要标上方向：in、out或者inout；</li>
<li>4.AIDL接口中支持方法，不支持声明静态变量；</li>
<li>5.为了方便AIDL的开发，建议把所有和AIDL相关的类和文件全部放入同一个包中，这样做的好处是，当客户端是另一个应用的时候，可以直接把整个包复制到客户端工程中。</li>
<li>6.RemoteCallbackList是系统专门提供的用于删除跨进程Listener的接口。RemoteCallbackList是一个泛型，支持管理任意的AIDL接口，因为所有的AIDL接口都继承自IInterface接口。</li>
</ul>
</li>
<li><p>(5)使用ContentProvider</p>
<ul>
<li>1.ContentProvider主要以表格的形式来组织数据，并且可以包含多个表；</li>
<li>2.ContentProvider还支持文件数据，比如图片、视频等，系统提供的MediaStore就是文件类型的ContentProvider；</li>
<li>3.ContentProvider对底层的数据存储方式没有任何要求，可以是SQLite、文件，甚至是内存中的一个对象都行；</li>
<li>4.要观察ContentProvider中的数据变化情况，可以通过ContentResolver的registerContentObserver方法来注册观察者；</li>
</ul>
</li>
<li><p>(6)使用Socket</p>
<p>Socket是网络通信中“套接字”的概念，分为流式套接字和用户数据包套接字两种，分别对应网络的传输控制层的TCP和UDP协议。</p>
</li>
</ul>
<h4 id="2-5-Binder连接池"><a href="#2-5-Binder连接池" class="headerlink" title="2.5 Binder连接池"></a>2.5 Binder连接池</h4><ul>
<li><p>(1)当项目规模很大的时候，创建很多个Service是不对的做法，因为service是系统资源，太多的service会使得应用看起来很重，所以最好是将所有的AIDL放在同一个Service中去管理。</p>
<p>整个工作机制是：每个业务模块创建自己的AIDL接口并实现此接口，这个时候不同业务模块之间是不能有耦合的，所有实现细节我们要单独开来，然后向服务端提供自己的唯一标识和其对应的Binder对象；对于服务端来说，只需要一个Service，服务端提供一个queryBinder接口，这个接口能够根据业务模块的特征来返回相应的Binder对象给它们，不同的业务模块拿到所需的Binder对象后就可以进行远程方法调用了。</p>
<p>Binder连接池的主要作用就是将每个业务模块的Binder请求统一转发到远程Service去执行，从而避免了重复创建Service的过程。</p>
</li>
<li><p>(2)作者实现的Binder连接池BinderPool的实现源码，建议在AIDL开发工作中引入BinderPool机制。</p>
</li>
</ul>
<h4 id="2-6-选用合适的IPC方式"><a href="#2-6-选用合适的IPC方式" class="headerlink" title="2.6 选用合适的IPC方式"></a>2.6 选用合适的IPC方式</h4><p><img src="/images/blogimages/2016/androidart_ipc.png" alt="选择合适的IPC方式"></p>
<h3 id="第9章-四大组件的工作过程"><a href="#第9章-四大组件的工作过程" class="headerlink" title="第9章 四大组件的工作过程"></a>第9章 四大组件的工作过程</h3><p>本篇摘选自<a href="http://blog.csdn.net/amurocrash/article/details/48858353" target="_blank" rel="external">amurocrash的专栏</a></p>
<h4 id="9-1-四大组件的运行状态"><a href="#9-1-四大组件的运行状态" class="headerlink" title="9.1 四大组件的运行状态"></a>9.1 四大组件的运行状态</h4><ul>
<li>(1)四大组件中只有BroadcastReceiver既可以在AndroidManifest文件中注册，也可以在代码中注册，其他三个组件都必须在AndroidManifest文件中注册；ContentProvider的调用不需要借助Intent，其他三个组件都需要借助Intent。</li>
<li>(2)Activity是一种展示型组件，用于向用户展示界面，可由显式或者隐式Intent来启动。</li>
<li>(3)Service是一种计算型组件，用于在后台执行计算任务。尽管service是用于后台执行计算的，但是它本身是运行在主线程中的，因此耗时的后台计算仍然需要在单独的线程中去完成。Service组件有两种状态：启动状态和绑定状态。当service处于绑定状态时，外界可以很方便的和service进行通信，而在启动状态中是不可与外界通信的。</li>
<li>(4)BroadcastReceiver是一种消息型组件，用于在不同的组件乃至不同的应用之间传递消息，它工作在系统内部。广播有两种注册方式：静态注册和动态注册。静态注册是在AndroidManifest中注册，在应用安装的时候会被系统解析，这种广播不需要应用启动就可以收到相应的广播。动态注册需要通过Context.registerReceiver()来注册，这种广播需要应用启动才能注册并接收广播。BroadcastReceiver组件一般来说不需要停止，它也没有停止的概念。</li>
<li>(5)ContentProvider是一种数据共享型组件，用于向其他组件乃至其他应用共享数据。ContentProvider中的insert、delete、update、query方法需要处理好线程同步，因为这几个方法是在Binder线程池中被调用的，另外ContentProvider组件也不需要手动停止。</li>
</ul>
<h4 id="9-2-Activity的工作过程"><a href="#9-2-Activity的工作过程" class="headerlink" title="9.2 Activity的工作过程"></a>9.2 Activity的工作过程</h4><h5 id="1-Activity启动的大致流程"><a href="#1-Activity启动的大致流程" class="headerlink" title="(1)Activity启动的大致流程"></a>(1)Activity启动的大致流程</h5><p><img src="/images/blogimages/2016/androidart_activity.png" alt="Activity启动的大致流程"></p>
<p>(2)ApplicationThread是ActivityThread的一个内部类，它继承自ApplicationThreadNative，而ApplicationThreadNative继承自Binder并实现了IApplicationThread接口，ApplicationThreadNative的作用其实就和系统为AIDL文件生成的类是一样的。<br>(3)ActivityManagerService(AMS)继承自ActivityManagerNative，而ActivityManagerNative继承自Binder并实现了IActivityManager这个Binder接口，因此AMS也是一个Binder。<br>(4)一个应用只有一个Application对象，它的创建也是通过Instrumentation来完成的，这个过程和Activity对象的创建过程一样，都是通过类加载器来实现的。<br>(5)ContextImpl是Context的具体实现，ContextImpl是通过Activity的attach方法来和Activity建立关联的，在attach方法中Activity还会完成Window的创建并建立自己和Window的关联，这样当window接收到外部输入事件后就可以将事件传递给Activity。 [这里可能有误，应该是Activity将事件传递给window]</p>
<h4 id="9-3-Service的工作过程"><a href="#9-3-Service的工作过程" class="headerlink" title="9.3 Service的工作过程"></a>9.3 Service的工作过程</h4><h5 id="1-Service有两种状态："><a href="#1-Service有两种状态：" class="headerlink" title="(1)Service有两种状态："></a>(1)Service有两种状态：</h5><p>启动状态和绑定状态，两种状态是可以共存的。<br><strong>启动过程：</strong><br><img src="/images/blogimages/2016/androidart_service1.png" alt="Service1"></p>
<p><strong>绑定过程：</strong><br><img src="/images/blogimages/2016/androidart_service2.png" alt="Service2"></p>
<h4 id="9-4-BroadcastReceiver的工作过程"><a href="#9-4-BroadcastReceiver的工作过程" class="headerlink" title="9.4 BroadcastReceiver的工作过程"></a>9.4 BroadcastReceiver的工作过程</h4><h5 id="1-BroadcastReceiver的工作过程包括广播注册过程、广播发送和接收过程。"><a href="#1-BroadcastReceiver的工作过程包括广播注册过程、广播发送和接收过程。" class="headerlink" title="(1)BroadcastReceiver的工作过程包括广播注册过程、广播发送和接收过程。"></a>(1)BroadcastReceiver的工作过程包括广播注册过程、广播发送和接收过程。</h5><p><strong>注册过程</strong>：静态注册的时候是由PackageManagerService来完成整个注册过程，下面是动态注册的过程<br><img src="/images/blogimages/2016/androidart_broadcastreceiver1.png" alt="broadcastreceiver1"><br><strong>发送和接收</strong>：<br><img src="/images/blogimages/2016/androidart_broadcastreceiver2.png" alt="broadcastreceiver2"></p>
<h5 id="2-广播的发送有几种类型："><a href="#2-广播的发送有几种类型：" class="headerlink" title="(2)广播的发送有几种类型："></a>(2)广播的发送有几种类型：</h5><p>普通广播、有序广播和粘性广播，有序广播和粘性广播与普通广播相比具有不同的特性，但是发送和接收过程是类似的。</p>
<h5 id="3-一个应用处于停止状态分为两种情况："><a href="#3-一个应用处于停止状态分为两种情况：" class="headerlink" title="(3)一个应用处于停止状态分为两种情况："></a>(3)一个应用处于停止状态分为两种情况：</h5><p>一是应用安装后未运行；二是应用被手动或者其他应用强停了。从Android 3.1开始，处于停止状态的应用无法接受到开机广播。</p>
<h4 id="9-5-ContentProvider的工作过程"><a href="#9-5-ContentProvider的工作过程" class="headerlink" title="9.5 ContentProvider的工作过程"></a>9.5 ContentProvider的工作过程</h4><h5 id="1-当ContentProvider所在的进程启动的时候，它会同时被启动并被发布到AMS中，这个时候它的onCreate要先去Application的onCreate执行。"><a href="#1-当ContentProvider所在的进程启动的时候，它会同时被启动并被发布到AMS中，这个时候它的onCreate要先去Application的onCreate执行。" class="headerlink" title="(1)当ContentProvider所在的进程启动的时候，它会同时被启动并被发布到AMS中，这个时候它的onCreate要先去Application的onCreate执行。"></a>(1)当ContentProvider所在的进程启动的时候，它会同时被启动并被发布到AMS中，这个时候它的onCreate要先去Application的onCreate执行。</h5><h5 id="2-ContentProvider的启动过程："><a href="#2-ContentProvider的启动过程：" class="headerlink" title="(2)ContentProvider的启动过程："></a>(2)ContentProvider的启动过程：</h5><ul>
<li>1.当一个应用启动时，入口方法是ActivityThread的main方法，其中创建ActivityThread的实例并创建主线程的消息队列；</li>
<li>2.ActivityThread的attach方法中会远程调用ActivityManagerService的attachApplication，并将ApplicationThread提供给AMS，ApplicationThread主要用于ActivityThread和AMS之间的通信；</li>
<li>3.ActivityManagerService的attachApplication会调用ApplicationThread的bindApplication方法，这个方法会通过H切换到ActivityThread中去执行，即调用handleBindApplication方法；</li>
<li>4.handleBindApplication方法会创建Application对象并加载ContentProvider，注意是先加载ContentProvider，然后调用Application的onCreate方法。</li>
</ul>
<h5 id="3-ContentProvider的android-multiprocess属性决定它是否是单实例，默认值是false，也就是默认是单实例。当设置为true时，每个调用者的进程中都存在一个ContentProvider对象。"><a href="#3-ContentProvider的android-multiprocess属性决定它是否是单实例，默认值是false，也就是默认是单实例。当设置为true时，每个调用者的进程中都存在一个ContentProvider对象。" class="headerlink" title="(3)ContentProvider的android:multiprocess属性决定它是否是单实例，默认值是false，也就是默认是单实例。当设置为true时，每个调用者的进程中都存在一个ContentProvider对象。"></a>(3)ContentProvider的android:multiprocess属性决定它是否是单实例，默认值是false，也就是默认是单实例。当设置为true时，每个调用者的进程中都存在一个ContentProvider对象。</h5><h5 id="4-当调用ContentProvider的insert、delete、update、query方法中的任何一个时，如果ContentProvider所在的进程没有启动的话，那么就会触发ContentProvider的创建，并伴随着ContentProvider所在进程的启动。下图是ContentProvider的query操作的大致过程："><a href="#4-当调用ContentProvider的insert、delete、update、query方法中的任何一个时，如果ContentProvider所在的进程没有启动的话，那么就会触发ContentProvider的创建，并伴随着ContentProvider所在进程的启动。下图是ContentProvider的query操作的大致过程：" class="headerlink" title="(4)当调用ContentProvider的insert、delete、update、query方法中的任何一个时，如果ContentProvider所在的进程没有启动的话，那么就会触发ContentProvider的创建，并伴随着ContentProvider所在进程的启动。下图是ContentProvider的query操作的大致过程："></a>(4)当调用ContentProvider的insert、delete、update、query方法中的任何一个时，如果ContentProvider所在的进程没有启动的话，那么就会触发ContentProvider的创建，并伴随着ContentProvider所在进程的启动。下图是ContentProvider的query操作的大致过程：</h5><p><img src="/images/blogimages/2016/androidart_contentprovider.png" alt="ContentProvider"></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://agehua.github.io/2016/03/20/android-books-reading-/" data-id="ciw6b0akd000ei6fyl4bcvi0b" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://agehua.github.io/2016/03/20/android-books-reading-/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://agehua.github.io/2016/03/20/android-books-reading-/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android-new-knowledge-summary" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/03/20/android-new-knowledge-summary/">android新特性新知识点总结</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/03/20/android-new-knowledge-summary/">
            <time datetime="2016-03-19T16:00:00.000Z" itemprop="datePublished">2016-03-20</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/accumulation/">accumulation</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/accumulation/">accumulation</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="一、mipmap-目录和drawable-目录有什么区别"><a href="#一、mipmap-目录和drawable-目录有什么区别" class="headerlink" title="一、mipmap 目录和drawable 目录有什么区别"></a>一、mipmap 目录和drawable 目录有什么区别</h3><p>Nexus 6 有 493 ppi，它刚好在 xxhdpi和xxxhdpi之间，所以显示的时候需要对xxxhdpi的资源进行缩小，如果你用了mipmap-xxxhdpi,那么这里会对sclae有一个优化，性能更好，占用内存更少。所以现在官方推荐使用mipmap：</p>
<h3 id="二、setTranslucentStatus-方法"><a href="#二、setTranslucentStatus-方法" class="headerlink" title="二、setTranslucentStatus()方法"></a>二、setTranslucentStatus()方法</h3><p>在Android4.4之后使用沉浸式状态栏，需要用到这个方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        <span class="comment">//首先检测当前的版本是否是api&gt;=19的</span></div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT)</div><div class="line">        &#123;</div><div class="line">            setTranslucentStatus(<span class="keyword">true</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        SystemBarTintManager tintManager = <span class="keyword">new</span> SystemBarTintManager(<span class="keyword">this</span>);</div><div class="line">        tintManager.setStatusBarTintEnabled(<span class="keyword">true</span>);</div><div class="line">        tintManager.setStatusBarTintColor(Color.parseColor(<span class="string">"#FFC1E0"</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@TargetApi</span>(<span class="number">19</span>)</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setTranslucentStatus</span><span class="params">(<span class="keyword">boolean</span> on)</span></span></div><div class="line">    &#123;</div><div class="line">        Window win = getWindow();</div><div class="line">        WindowManager.LayoutParams winParams = win.getAttributes();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> bits = WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS;</div><div class="line">        <span class="keyword">if</span> (on)</div><div class="line">        &#123;</div><div class="line">            winParams.flags |= bits;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            winParams.flags &amp;= ~bits;</div><div class="line">        &#125;</div><div class="line">        win.setAttributes(winParams);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>布局设置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">              android:layout_width=&quot;match_parent&quot;</div><div class="line">              android:layout_height=&quot;match_parent&quot;</div><div class="line">              &lt;!--这两行是必须设置的--&gt;</div><div class="line">              android:fitsSystemWindows=&quot;true&quot;</div><div class="line">              android:clipToPadding=&quot;true&quot;</div><div class="line"></div><div class="line">              android:orientation=&quot;vertical&quot;</div><div class="line">              android:background=&quot;#FFD9EC&quot;</div><div class="line">        &gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">            android:text=&quot;沉浸式状态栏&quot;</div><div class="line">            android:layout_width=&quot;match_parent&quot;</div><div class="line">            android:layout_height=&quot;50dp&quot;</div><div class="line">            android:textSize=&quot;23dp&quot;</div><div class="line">            android:layout_gravity=&quot;center_horizontal&quot;</div><div class="line">            android:gravity=&quot;center&quot;</div><div class="line">            android:background=&quot;#FFD9EC&quot;</div><div class="line">            /&gt;</div><div class="line">    &lt;TextView</div><div class="line">            android:layout_width=&quot;match_parent&quot;</div><div class="line">            android:layout_height=&quot;match_parent&quot;</div><div class="line">            android:background=&quot;@android:color/darker_gray&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<h3 id="三、获取Bitmap图片大小的代码"><a href="#三、获取Bitmap图片大小的代码" class="headerlink" title="三、获取Bitmap图片大小的代码"></a>三、获取Bitmap图片大小的代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBitmapSize</span><span class="params">(Bitmap bitmap)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT)&#123;     <span class="comment">//API 19</span></div><div class="line">        <span class="keyword">return</span> bitmap.getAllocationByteCount();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB_MR1)&#123;<span class="comment">//API 12</span></div><div class="line">        <span class="keyword">return</span> bitmap.getByteCount();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> bitmap.getRowBytes() * bitmap.getHeight();                <span class="comment">//earlier version</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="四、Activity横竖屏切换生命周期"><a href="#四、Activity横竖屏切换生命周期" class="headerlink" title="四、Activity横竖屏切换生命周期"></a>四、Activity横竖屏切换生命周期</h3><p>总结：</p>
<ul>
<li><p>1、不设置Activity的android:configChanges时，切屏会重新调用各个生命周期，切横屏时会执行一次，切竖屏时会执行两次</p>
</li>
<li><p>2、设置Activity的android:configChanges=”orientation”时，切屏还是会重新调用各个生命周期，切横、竖屏时只会执行一次</p>
</li>
<li><p>3、设置Activity的android:configChanges=”orientation|keyboardHidden”时，切屏不会重新调用各个生命周期，只会执行onConfigurationChanged方法</p>
</li>
</ul>
<p>验证：</p>
<p>1、新建一个Activity，并把各个生命周期打印出来</p>
<p>2、运行Activity，得到如下信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">onCreate--&gt;</div><div class="line">onStart--&gt;</div><div class="line">onResume--&gt;</div></pre></td></tr></table></figure>
<p>3、按crtl+f12切换成横屏时</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">onSaveInstanceState--&gt;</div><div class="line">onPause--&gt;</div><div class="line">onStop--&gt;</div><div class="line">onDestroy--&gt;</div><div class="line">onCreate--&gt;</div><div class="line">onStart--&gt;</div><div class="line">onRestoreInstanceState--&gt;</div><div class="line">onResume--&gt;</div></pre></td></tr></table></figure>
<p>4、再按crtl+f12切换成竖屏时，发现打印了两次相同的log</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">onSaveInstanceState--&gt;</div><div class="line">onPause--&gt;</div><div class="line">onStop--&gt;</div><div class="line">onDestroy--&gt;</div><div class="line">onCreate--&gt;</div><div class="line">onStart--&gt;</div><div class="line">onRestoreInstanceState--&gt;</div><div class="line">onResume--&gt;</div><div class="line">onSaveInstanceState--&gt;</div><div class="line">onPause--&gt;</div><div class="line">onStop--&gt;</div><div class="line">onDestroy--&gt;</div><div class="line">onCreate--&gt;</div><div class="line">onStart--&gt;</div><div class="line">onRestoreInstanceState--&gt;</div><div class="line">onResume--&gt;</div></pre></td></tr></table></figure>
<p>5、修改AndroidManifest.xml，把该Activity添加 android:configChanges=”orientation”，执行步骤3</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">onSaveInstanceState--&gt;</div><div class="line">onPause--&gt;</div><div class="line">onStop--&gt;</div><div class="line">onDestroy--&gt;</div><div class="line">onCreate--&gt;</div><div class="line">onStart--&gt;</div><div class="line">onRestoreInstanceState--&gt;</div><div class="line">onResume--&gt;</div></pre></td></tr></table></figure>
<p>6、再执行步骤4，发现不会再打印相同信息，但多打印了一行onConfigChanged</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">onSaveInstanceState--&gt;</div><div class="line">onPause--&gt;</div><div class="line">onStop--&gt;</div><div class="line">onDestroy--&gt;</div><div class="line">onCreate--&gt;</div><div class="line">onStart--&gt;</div><div class="line">onRestoreInstanceState--&gt;</div><div class="line">onResume--&gt;</div><div class="line">onConfigurationChanged--&gt;</div></pre></td></tr></table></figure>
<p>7、把步骤5的android:configChanges=”orientation” 改成android:configChanges=”orientation|keyboardHidden”，执行步骤3，就只打印onConfigChanged</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">onConfigurationChanged--&gt;</div></pre></td></tr></table></figure>
<p>8、执行步骤4</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">onConfigurationChanged--&gt;</div><div class="line">onConfigurationChanged--&gt;</div></pre></td></tr></table></figure>
<p>总结一下整个Activity的生命周期</p>
<ul>
<li>1.补充一点，当前Activity产生事件弹出Toast和AlertDialog的时候Activity的生命周期不会有改变</li>
<li>2.Activity运行时按下HOME键(跟被完全覆盖是一样的)：onSaveInstanceState –&gt; onPause –&gt; onStop       onRestart –&gt;onStart—&gt;onResume</li>
<li>3.Activity未被完全覆盖只是失去焦点：onPause—&gt;onResume</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://agehua.github.io/2016/03/20/android-new-knowledge-summary/" data-id="ciw6b0ak70009i6fys57mks0c" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://agehua.github.io/2016/03/20/android-new-knowledge-summary/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://agehua.github.io/2016/03/20/android-new-knowledge-summary/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-facebook-google+signin" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/03/15/facebook-google+signin/">近期总结facebook google+ Twitter sign-in fragment使用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/03/15/facebook-google+signin/">
            <time datetime="2016-03-14T16:00:00.000Z" itemprop="datePublished">2016-03-15</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/accumulation/">accumulation</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/accumulation/">accumulation</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="1-相关资料"><a href="#1-相关资料" class="headerlink" title="1.相关资料"></a>1.相关资料</h3><p>blog: <a href="http://www.cnblogs.com/lngg057/p/5020192.html" target="_blank" rel="external">关于Google+以及Facebook第三方登录实现的一点总结</a></p>
<p>g+官方教程: <a href="https://developers.google.com/identity/sign-in/android/start" target="_blank" rel="external">G+ start</a></p>
<p>facebook官方教程: <a href="https://developers.facebook.com/docs/android/getting-started" target="_blank" rel="external">Facebook start</a></p>
<p>iCCP: <a href="http://www.bigademo.com/iccp-not-recognizing-known-srgb-profile/" target="_blank" rel="external">Not recognizing known sRGB profile</a></p>
<ul>
<li><p>今天做分享的时候遇到了这个问题：</p>
<p>  [2016-04-01 11:24:04 - Dex Loader] Unable to execute dex: method ID not in [0, 0xffff]: 65536<br>  [2016-04-01 11:24:04 - VIVAT_SHARESDK] Conversion to Dalvik format failed: Unable to execute dex: method ID not in [0, 0xffff]: 65536</p>
</li>
</ul>
<p><a href="http://www.cnblogs.com/yaozhongxiao/p/3521428.html" target="_blank" rel="external">大项目中遇到的问题看这个博客</a></p>
<ul>
<li>iCCP: Not recognizing known sRGB profile 删除png图片内嵌的iCCP profile sRGB报错</li>
</ul>
<p>今天有碰见一个坑，改其他代码，然后在编译的时候就出现这个问题，对就是这个问题。网上查了资料，也就这个资料最全面，大家可以去看见<a href="http://my.oschina.net/1pei/blog/479162?fromerr=ARrUPlGS" target="_blank" rel="external">http://my.oschina.net/1pei/blog/479162?fromerr=ARrUPlGS</a></p>
<p>处理这个问题我使用了一种方法，记录下来以便以后使用</p>
<p>步骤1:下载Image Magick <a href="http://www.imagemagick.com.cn/download.html.如果是windows的，请下载含dll的" target="_blank" rel="external">http://www.imagemagick.com.cn/download.html.如果是windows的，请下载含dll的</a></p>
<p>步骤2： 在要处理的文件夹使用如下命令 ，一定要在要处理的文件夹使用</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">//WINDOWS使用</div><div class="line">set fn=E:\Program Files\ImageMagick-6.9.0-Q16\convert.exe  </div><div class="line">for /f "tokens=*" %i in ('dir/s/b *.png') do "%fn%" "%i" -strip "%i"</div><div class="line">（因为是window的，所以把%%i改为%i）</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">//LINUX使用</div><div class="line"> set fn=E:\Program Files\ImageMagick-6.9.0-Q16\convert.exe  </div><div class="line">for /f "tokens=*" %%i in ('dir/s/b *.png') do "%fn%" "%%i" -strip "%%i"</div></pre></td></tr></table></figure>
<h3 id="2-遇到问题"><a href="#2-遇到问题" class="headerlink" title="2.遇到问题"></a>2.遇到问题</h3><ul>
<li><p>1.“This client application’s callback url has been locked”.</p>
<p>  使用Twitter signin时遇到了这个问题，这个错误信息是在logcat中找到的，原因是在<a href="https://apps.twitter.com" target="_blank" rel="external">Twitter</a>的Settings里勾选了“Enable Callback Locking (It is recommended to enable callback locking to ensure apps cannot overwrite the callback url)”选项，这个选项表示不允许app本地更改callback url。也可看这个<a href="https://twittercommunity.com/t/callback-url-is-locked/59481" target="_blank" rel="external">页面</a></p>
</li>
</ul>
<h3 id="3-add-vs-replace"><a href="#3-add-vs-replace" class="headerlink" title="3.add() vs. replace()"></a>3.add() vs. replace()</h3><ul>
<li><p>只有在Fragment数量大于等于2的时候，调用add()还是replace()的区别才能体现出来。</p>
<p>  当通过add()连续两次添加Fragment的时候，每个Fragment生命周期中的onAttach()-onResume()都会被各调用一次，而且两个Fragment的View会被同时attach到containerView。</p>
<p>  同样，退出Activty时，每个Fragment生命周期中的onPause()-onDetach()也会被各调用一次。</p>
<p>  但当使用replace()来添加Fragment的时候，第二次添加会导致第一个Fragment被销毁，即执行第二个Fragment的onAttach()方法之前会先执行第一个Fragment的onPause()-onDetach()方法，同时containerView会detach第一个Fragment的View。</p>
</li>
<li><p>调用show() &amp; hide()方法时.</p>
<p>  Fragment的生命周期方法并不会被执行，仅仅是Fragment的View被显示或者​隐藏。而且，尽管Fragment的View被隐藏，但它在父布局中并未被detach，仍然是作为containerView的childView存在着。相比较下，attach() &amp; detach()做的就更彻底一些。一旦一个Fragment被detach()，它的onPause()-onDestroyView()周期都会被执行。</p>
<p>  同时Fragment的View也会被detach。在重新调用attach()后，onCreateView()-onResume()周期也会被再次执行。</p>
</li>
<li><p>remove()</p>
<p>  其实看完上面的分析，remove()方法基本也就明白了。相对应add()方法执行onAttach()-onResume()的生命周期，remove()就是完成剩下的onPause()-onDetach()周期。</p>
</li>
</ul>
<h3 id="4-FragmentTransaction-add-和-replace-区别"><a href="#4-FragmentTransaction-add-和-replace-区别" class="headerlink" title="4.FragmentTransaction add 和 replace 区别"></a>4.FragmentTransaction add 和 replace 区别</h3><p>使用 FragmentTransaction 的时候，它提供了这样两个方法，一个 add ， 一个 replace .add 和 replace 影响的只是界面，而控制回退的，是事务。</p>
<ul>
<li><p>add 是把一个fragment添加到一个容器 container 里。</p>
<p>  Add a fragment to the activity state. This fragment may optionally also have its view (if Fragment.onCreateView returns non-null) into a container view of the activity.</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> FragmentTransaction <span class="title">add</span> <span class="params">(<span class="keyword">int</span> containerViewId, Fragment fragment, String tag)</span></span></div></pre></td></tr></table></figure>
<ul>
<li><p>replace 是先remove掉相同id的所有fragment，然后在add当前的这个fragment。</p>
<p>  Replace an existing fragment that was added to a container. This is essentially the same as calling remove(Fragment) for all currently added fragments that were added with the same containerViewId and then add(int, Fragment, String) with the same arguments given here.</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> FragmentTransaction <span class="title">replace</span> <span class="params">(<span class="keyword">int</span> containerViewId, Fragment fragment, String tag)</span></span></div></pre></td></tr></table></figure>
<p>在大部分情况下，这两个的表现基本相同。因为，一般，咱们会使用一个FrameLayout来当容器，而每个Fragment被add 或者 replace 到这个FrameLayout的时候，都是显示在最上层的。所以你看到的界面都是一样的。但是，使用add的情况下，这个FrameLayout其实有2层，多层肯定要比一层的来得浪费，所以还是推荐使用replace。当然有时候还是需要使用add的。比如要实现轮播图的效果，每个轮播图都是一个独立的Fragment，而他的容器FrameLayout需要add多个Fragment，这样他就可以根据提供的逻辑进行轮播了。</p>
<p>而至于返回键的时候，这个跟事务有关，跟使用add还是replace没有任何关系。</p>
<h3 id="5-要想fragment完整地执行生命周期"><a href="#5-要想fragment完整地执行生命周期" class="headerlink" title="5.要想fragment完整地执行生命周期"></a>5.要想fragment完整地执行生命周期</h3><p>fragment跳转是要使用replace()方法，并一定要指定tag，否则有些方法不会执行（比如onResume），例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">getFragmentManager()</div><div class="line"> 	.beginTransaction()</div><div class="line">    .replace(R.id.base_container,</div><div class="line">    	 inputVerifyCodeFragment,<span class="string">"tag_code"</span>)</div><div class="line">    .addToBackStack(<span class="keyword">null</span>).commit();</div></pre></td></tr></table></figure>
<h3 id="6-fragment事件穿透"><a href="#6-fragment事件穿透" class="headerlink" title="6.fragment事件穿透"></a>6.fragment事件穿透</h3><p>如果发现fragment2的点击事件可以被fragment栈下一层的fragment1获取到，可以在fragment2布局的根部加上：android:clickable=”true”。问题解决</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://agehua.github.io/2016/03/15/facebook-google+signin/" data-id="ciw6b0ak50008i6fy5h02p3vd" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://agehua.github.io/2016/03/15/facebook-google+signin/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://agehua.github.io/2016/03/15/facebook-google+signin/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-android-googlemap-summary" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/03/01/android-googlemap-summary/">android Google map使用总结</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/03/01/android-googlemap-summary/">
            <time datetime="2016-02-29T16:00:00.000Z" itemprop="datePublished">2016-03-01</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/technology/">technology</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/accumulation/">accumulation</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="1-在代码中编译google-map"><a href="#1-在代码中编译google-map" class="headerlink" title="1.在代码中编译google map"></a>1.在代码中编译google map</h3><p>要想编译编译google map必须使用Google map api。并在自己的工程中引入google-play-services_lib。两个都需要在SDK Manager中下载。前者要在对应android api中勾选，后者要勾选在Extras下的Google Play Service。</p>
<p>要注意的是map2.0要使用com.google.android.gms包名下的类</p>
<p>Google Maps Android API 使用OpenGL ES第2版来渲染地图。如果未安装OpenGL ES第2版，地图将不会出现。可以在 AndroidManifest.xml 中添加以下<uses-feature>元素作为<manifest>元素的子元素来过滤不能支持的手机：</manifest></uses-feature></p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">&lt;uses-feature</div><div class="line">        android:glEsVersion=<span class="string">"0x00020000"</span></div><div class="line">        android:required=<span class="string">"true"</span>/&gt;</div></pre></td></tr></table></figure>
<h3 id="2-在编码中遇到的问题"><a href="#2-在编码中遇到的问题" class="headerlink" title="2.在编码中遇到的问题"></a>2.在编码中遇到的问题</h3><p>1.可以实现OnCameraChangeListener接口，来实现对相机状态的监听，比如我就记录下了地图缩放的大小</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCameraChange</span><span class="params">(CameraPosition arg0)</span> </span>&#123;</div><div class="line">	<span class="comment">// TODO Auto-generated method stub</span></div><div class="line">	zoom = arg0.zoom;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.向将处理地图的 Activity 添加 Fragment 对象。 最简单的实现方式是，向Activity 的布局文件添加 <fragment> 元素。</fragment></p>
<p>3.实现 OnMapReadyCallback 接口，并使用onMapReady(GoogleMap)回调方法获取GoogleMap对象的句柄。GoogleMap对象是对地图本身的内部表示。如需设置地图的视图选项，可以使用UiSettings设置地图的样式。</p>
<p>4.调用Fragment上的getMapAsync()以注册回调。</p>
<p>5.使用手机定位，定位成功后再map上显示标记：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line">MarkerOptions markerOpt = <span class="keyword">new</span> MarkerOptions();  </div><div class="line">markerOpt.position(<span class="keyword">new</span> LatLng(geoLat, geoLng));  </div><div class="line">markerOpt.draggable(<span class="keyword">false</span>);  </div><div class="line">markerOpt.visible(<span class="keyword">true</span>);  </div><div class="line">markerOpt.anchor(<span class="number">0.5f</span>, <span class="number">0.5f</span>);<span class="comment">//设为图片中心  </span></div><div class="line">markerOpt.icon(BitmapDescriptorFactory  </div><div class="line">	.fromResource(R.drawable.sos_location_38x53));  </div><div class="line">mMap.addMarker(markerOpt);  </div><div class="line"><span class="comment">//将摄影机移动到指定的地理位置  </span></div><div class="line">cameraPosition = <span class="keyword">new</span> CameraPosition.Builder()  </div><div class="line">.target(<span class="keyword">new</span> LatLng(geoLat, geoLng))              <span class="comment">// Sets the center of the map to ZINTUN  </span></div><div class="line">	.zoom(zoom)                  <span class="comment">// 缩放比例  </span></div><div class="line">	.bearing(<span class="number">0</span>)                <span class="comment">// Sets the orientation of the camera to east  </span></div><div class="line">	.build();                  <span class="comment">// Creates a CameraPosition from the builder  </span></div><div class="line">mMap.animateCamera(CameraUpdateFactory.newCameraPosition(cameraPosition));</div><div class="line">~~~   </div><div class="line"></div><div class="line"><span class="number">6</span>.实现地图圆角效果：使用圆角.<span class="number">9</span>图片，中间透明，圆角四周不透明&lt;br&gt;</div><div class="line">详细可以看这个提问：[Is there a way to implement rounded corners to a Mapfragment?](http:<span class="comment">//stackoverflow.com/questions/14469208/is-there-a-way-to-implement-rounded-corners-to-a-mapfragment)</span></div><div class="line"></div><div class="line"><span class="number">7</span>.去掉google地图自带的蓝色圆点</div><div class="line">GoogleMap.setMyLocationEnabled(<span class="keyword">false</span>);</div><div class="line"></div><div class="line"><span class="number">8</span>.解决mapview与scrollview嵌套滑动的问题：</div><div class="line">思路就是使用getParent().requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);方法，让子类接收到touch事件</div><div class="line"></div><div class="line">~~~ Java</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMapView</span> <span class="keyword">extends</span> <span class="title">MapView</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ViewParent mViewParent;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyMapView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyMapView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyMapView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyMapView</span><span class="params">(Context context, GoogleMapOptions options)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, options);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setViewParent</span><span class="params">(@Nullable <span class="keyword">final</span> ViewParent viewParent)</span> </span>&#123; <span class="comment">//any ViewGroup</span></div><div class="line">        mViewParent = viewParent;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(<span class="keyword">final</span> MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == mViewParent) &#123;</div><div class="line">                    <span class="comment">//设置父类不拦截touch事件，子view可以接收到touch事件</span></div><div class="line">                    getParent().requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    mViewParent.requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == mViewParent) &#123;</div><div class="line">                    <span class="comment">//让父类拦截touch事件</span></div><div class="line">                    getParent().requestDisallowInterceptTouchEvent(<span class="keyword">false</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    mViewParent.requestDisallowInterceptTouchEvent(<span class="keyword">false</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(event);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>9.LocationListener，一直回调到onProviderDisabled</p>
<p>有可能是因为手机没有开启定位服务，解决办法是：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProviderDisabled</span><span class="params">(String provider)</span> </span>&#123;</div><div class="line">    isLocatedSuccess = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">if</span> (provider.equals(<span class="string">"network"</span>)) <span class="comment">//跳到位置服务设置页面</span></div><div class="line">        startActivity(<span class="keyword">new</span> Intent(android.provider.Settings.ACTION_LOCATION_SOURCE_SETTINGS));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-在真机上测试效果"><a href="#3-在真机上测试效果" class="headerlink" title="3.在真机上测试效果"></a>3.在真机上测试效果</h3><p>需要在真机上安装这两个包：com.android.vending.apk（Google play store）和com.google.android.gms.apk（Google play services）<br>可以在国内应用市场上去搜索最新版本，也可以使用我上传的文件：</p>
<p>链接：<a href="http://pan.baidu.com/s/1i5q8jo5" target="_blank" rel="external">http://pan.baidu.com/s/1i5q8jo5</a> 密码：solm</p>
<p>安装成功以后，再运行自己的程序，查看效果了</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://agehua.github.io/2016/03/01/android-googlemap-summary/" data-id="ciw6b0ak8000ai6fy4sjftijr" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://agehua.github.io/2016/03/01/android-googlemap-summary/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://agehua.github.io/2016/03/01/android-googlemap-summary/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="book-book-list-of-2015" class="article article-type-book" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2015/11/06/book-list-of-2015/">2015阅读书单</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2015/11/06/book-list-of-2015/">
            <time datetime="2015-11-05T16:00:00.000Z" itemprop="datePublished">2015-11-06</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/read/">read</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/read/">read</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://agehua.github.io/2015/11/06/book-list-of-2015/" data-id="ciw6b0ajw0004i6fyrqt0eyht" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://agehua.github.io/2015/11/06/book-list-of-2015/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://agehua.github.io/2015/11/06/book-list-of-2015/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-java-multithreading-concurrent" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2015/03/16/java-multithreading-concurrent/">java多线程和并发面试问答</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2015/03/16/java-multithreading-concurrent/">
            <time datetime="2015-03-15T16:00:00.000Z" itemprop="datePublished">2015-03-16</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/technology/">technology</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/accumulation/">accumulation</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>本文基于<strong>酷勤网关于java多线程和并发面试题的文</strong>章，进行了少量的整理和补充。<a href="http://www.kuqin.com/shuoit/20140708/341091.html" target="_blank" rel="external">原文在这</a>。</p>
<hr>
<p>以下是正文：</p>
<p>多线程和并发问题是Java技术面试中面试官比较喜欢问的问题之一。在这里，从面试的角度列出了大部分重要的问题，但是你仍然应该牢固的掌握Java多线程基础知识来对应日后碰到的问题。</p>
<h1 id="Java多线程面试问题"><a href="#Java多线程面试问题" class="headerlink" title="Java多线程面试问题"></a>Java多线程面试问题</h1><h3 id="1-什么是进程和线程？"><a href="#1-什么是进程和线程？" class="headerlink" title="1. 什么是进程和线程？"></a>1. 什么是进程和线程？</h3><p>进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动，进程是系统进行资源分配和调度的一个独立单位。线程是进程的一个实体，是CPU调度和分派的基本单位，它是比进程更小的能独立运行的基本单位。</p>
<p>线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源（如程序计数器，一组寄存器和栈），但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。一个线程可以创建和撤销另一个线程；同一个进程中的多个线程之间可以并发执行。相对进程而言，线程是一个更加接近于执行体的概念，它可以与同进程中的其他线程共享数据，但拥有自己的栈空间，拥有独立的执行序列。在串行程序基础上引入线程和进程是为了提高程序的并发度，从而提高程序运行效率和响应时间。</p>
<h3 id="2-进程和线程之间有什么不同？"><a href="#2-进程和线程之间有什么不同？" class="headerlink" title="2. 进程和线程之间有什么不同？"></a>2. 进程和线程之间有什么不同？</h3><p>一个进程是一个独立(self contained)的运行环境，它可以被看作一个程序或者一个应用。而线程是在进程中执行的一个任务。</p>
<ul>
<li>简而言之,一个程序至少有一个进程,一个进程至少有一个线程。</li>
<li>线程的划分尺度小于进程，使得多线程程序的并发性高。</li>
<li>进程在执行过程中拥有独立的内存单元，而多个线程共享内存，极大地提高了程序的运行效率。</li>
<li>线程在执行过程中与进程还是有区别的。每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口。但线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。</li>
<li>从逻辑角度来看，多线程的意义在于一个应用程序中，有多个执行部分可以同时执行。但操作系统并没有将多个线程看做多个独立的应用，来实现进程的调度和管理以及资源分配。这就是进程和线程的重要区别。</li>
</ul>
<blockquote>
<p>形象的讲，进程就是一个项目组，每个程序员就是里面的线程呀！当然一个程序员也可以叫做一个项目组，对应的就是一个进程只有一个线程。公司里面的任务是分配给项目组级别的，干活的就是其中的程序员。总的意思就是，进程和线程没有什么区别。<br>吐槽的话：我的意思就是进程干不过来了，那就多开几个线程呀！from <a href="https://www.zhihu.com/question/21535820/answer/19120563" target="_blank" rel="external">JacobK</a></p>
</blockquote>
<h3 id="3-多线程编程的好处是什么？"><a href="#3-多线程编程的好处是什么？" class="headerlink" title="3. 多线程编程的好处是什么？"></a>3. 多线程编程的好处是什么？</h3><ul>
<li>在进程内创建、终止线程比创建、终止进程要快；</li>
<li>同一进程内的线程间切换比进程间的切换要快,尤其是用户级线程间的切换。</li>
</ul>
<p>在多线程程序中，多个线程被并发的执行以提高程序的效率，CPU不会因为某个线程需要等待资源而进入空闲状态。多个线程共享堆内存(heap memory)，因此创建多个线程去执行一些任务会比创建多个进程更好。举个例子，Servlets比CGI更好，是因为Servlets支持多线程而CGI不支持。</p>
<h3 id="4-用户线程和守护线程有什么区别？"><a href="#4-用户线程和守护线程有什么区别？" class="headerlink" title="4. 用户线程和守护线程有什么区别？"></a>4. 用户线程和守护线程有什么区别？</h3><p>当我们在Java程序中创建一个线程，它就被称为用户线程。一个守护线程是在后台执行并且不会阻止JVM终止的线程。当没有用户线程在运行的时候，JVM关闭程序并且退出（与守护线程是否在运行没有关系）。一个守护线程创建的子线程依然是守护线程。<strong>守护线程应用背景</strong>：后台线程，比如可以收集某些系统状态的线程，发送email的线程，等不希望影响JVM的事情。</p>
<h3 id="5-我们如何创建一个线程？"><a href="#5-我们如何创建一个线程？" class="headerlink" title="5. 我们如何创建一个线程？"></a>5. 我们如何创建一个线程？</h3><p>有两种创建线程的方法：一是实现Runnable接口，然后将它传递给Thread的构造函数，创建一个Thread对象；二是直接继承Thread类。<a href="http://www.journaldev.com/1016/java-thread-example-extending-thread-class-and-implementing-runnable-interface" target="_blank" rel="external">Read more…</a></p>
<h3 id="6-有哪些不同的线程生命周期？"><a href="#6-有哪些不同的线程生命周期？" class="headerlink" title="6. 有哪些不同的线程生命周期？"></a>6. 有哪些不同的线程生命周期？</h3><p>当我们在Java程序中新建一个线程时，它的状态是New。当我们调用线程的start()方法时，状态被改变为Runnable。线程调度器会为Runnable线程池中的线程分配CPU时间并且讲它们的状态改变为Running。其他的线程状态还有Waiting，Blocked和Dead。<a href="http://www.journaldev.com/1044/life-cycle-of-thread-understanding-thread-states-in-java" target="_blank" rel="external">Read more…</a></p>
<ul>
<li><strong>新建（new Thread）</strong>：当创建Thread类的一个实例（对象）时，此线程进入新建状态（未被启动）。例如：<code>Thread  t1=new Thread()</code>;</li>
<li><strong>就绪（runnable）</strong>：线程已经被启动，正在等待被分配给CPU时间片，也就是说此时线程正在就绪队列中排队等候得到CPU资源。例如：<code>t1.start()</code>;</li>
<li><strong>运行（running）</strong>：线程获得CPU资源正在执行任务（run()方法），此时除非此线程自动放弃CPU资源或者有优先级更高的线程进入，线程将一直运行到结束。</li>
<li><strong>死亡（dead）</strong>：当线程执行完毕或被其它线程杀死，线程就进入死亡状态，这时线程不可能再进入就绪状态等待执行。</li>
<li><strong>自然终止</strong>：正常运行run()方法后终止</li>
<li><strong>异常终止</strong>：调用stop()方法让一个线程终止运行</li>
<li><strong>堵塞（blocked）</strong>：由于某种原因导致正在运行的线程让出CPU并暂停自己的执行，即进入堵塞状态。</li>
<li><strong>正在睡眠</strong>：用sleep(long t) 方法可使线程进入睡眠方式。一个睡眠着的线程在指定的时间过去可进入就绪状态。</li>
<li><strong>正在等待</strong>：调用wait()方法。（调用motify()方法回到就绪状态）</li>
<li><strong>被另一个线程所阻塞</strong>：调用suspend()方法。（调用resume()方法恢复）</li>
</ul>
<h3 id="7-可以直接调用Thread类的run-方法么？"><a href="#7-可以直接调用Thread类的run-方法么？" class="headerlink" title="7. 可以直接调用Thread类的run()方法么？"></a>7. 可以直接调用Thread类的run()方法么？</h3><p>可以，但是如果我们调用了Thread的run()方法，它的行为就会和普通的方法一样，为了在新的线程中执行我们的代码，必须使用Thread。start()方法。</p>
<h3 id="8-如何让正在运行的线程暂停一段时间？"><a href="#8-如何让正在运行的线程暂停一段时间？" class="headerlink" title="8. 如何让正在运行的线程暂停一段时间？"></a>8. 如何让正在运行的线程暂停一段时间？</h3><p>我们可以使用Thread类的Sleep()方法让线程暂停一段时间。需要注意的是，这并不会让线程终止，一旦从休眠中唤醒线程，线程的状态将会被改变为Runnable，并且根据线程调度，它将得到执行。</p>
<h3 id="9-你对线程优先级的理解是什么？"><a href="#9-你对线程优先级的理解是什么？" class="headerlink" title="9. 你对线程优先级的理解是什么？"></a>9. 你对线程优先级的理解是什么？</h3><p>线程的优先级越高，那么就可以分占相对多的CPU时间片。每个进程都有相应的优先级，<strong>线程优先级决定它何时运行和占用CPU时间</strong>。最终的优先级共分32级。是从0到31的数值，称为 <strong>基本优先级别</strong>。OS调度的是线程，<strong>真正具有优先级的是线程</strong>，而进程优先级是作为一个优先级Class存在。一个线程创建的时候，会继承进程的优先级。 外线程优先级可以用SetThreadPriority来进行微调。常用的桌面系统，都是分时操调度，根据线程的优先级来分配调度时间。我们可以定义线程的优先级，但是这并不能保证高优先级的线程会在低优先级的线程前执行。</p>
<h3 id="10-什么是线程调度器-Thread-Scheduler-和时间分片-Time-Slicing-？"><a href="#10-什么是线程调度器-Thread-Scheduler-和时间分片-Time-Slicing-？" class="headerlink" title="10. 什么是线程调度器(Thread Scheduler)和时间分片(Time Slicing)？"></a>10. 什么是线程调度器(Thread Scheduler)和时间分片(Time Slicing)？</h3><p>线程调度器是一个操作系统服务，它负责为Runnable状态的线程分配CPU时间。一旦我们创建一个线程并启动它，它的执行便依赖于线程调度器的实现。时间分片是指将可用的CPU时间分配给可用的Runnable线程的过程。分配CPU时间可以基于线程优先级或者线程等待的时间。线程调度并不受到Java虚拟机控制，所以由应用程序来控制它是更好的选择（也就是说不要让你的程序依赖于线程的优先级）。</p>
<h3 id="11-在多线程中，什么是上下文切换-context-switching-？"><a href="#11-在多线程中，什么是上下文切换-context-switching-？" class="headerlink" title="11. 在多线程中，什么是上下文切换(context-switching)？"></a>11. 在多线程中，什么是上下文切换(context-switching)？</h3><p>上下文切换是存储和恢复CPU状态的过程，它使得线程执行能够从中断点恢复执行。上下文切换是多任务操作系统和多线程环境的基本特征。</p>
<h3 id="12-你如何确保main-方法所在的线程是Java程序最后结束的线程？"><a href="#12-你如何确保main-方法所在的线程是Java程序最后结束的线程？" class="headerlink" title="12. 你如何确保main()方法所在的线程是Java程序最后结束的线程？"></a>12. 你如何确保main()方法所在的线程是Java程序最后结束的线程？</h3><p>我们可以使用Thread类的joint()方法来确保所有程序创建的线程在main()方法退出前结束。<a href="http://www.journaldev.com/1024/java-thread-join-example-with-explanation" target="_blank" rel="external">Read more…</a></p>
<blockquote>
<p>线程实例的方法join()方法可以使得一个线程在另一个线程结束后再执行。如果join()方法在一个线程实例上调用，当前运行着的线程将阻塞直到这个线程实例完成了执行。在join()方法内设定超时，使得join()方法的影响在特定超时后无效。当超时时，主方法和任务线程申请运行的时候是平等的。然而，当涉及sleep时，join()方法依靠操作系统计时，所以你不应该假定join()方法将会等待你指定的时间。</p>
</blockquote>
<h3 id="13-线程之间是如何通信的？"><a href="#13-线程之间是如何通信的？" class="headerlink" title="13.线程之间是如何通信的？"></a>13.线程之间是如何通信的？</h3><p>线程间通信有三种方式：</p>
<p>a. 使用全局变量。进程中的线程间内存共享，这是比较常用的通信方式和交互方式。主要由于多个线程可能更改全局变量，因此全局变量最好声明为violate</p>
<p>b. 使用消息实现通信。在Windows程序设计中，每一个线程都可以拥有自己的消息队列（UI线程默认自带消息队列和消息循环，工作线程需要手动实现消息循环），因此可以采用消息进行线程间通信sendMessage,postMessage。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">1)定义消息#define WM_THREAD_SENDMSG=WM_USER+20;  </div><div class="line">2)添加消息函数声明afx_msg int OnTSendmsg();</div><div class="line">3)添加消息映射ON_MESSAGE(WM_THREAD_SENDMSG,OnTSM)</div><div class="line">4)添加OnTSM()的实现函数；</div><div class="line">5)在线程函数中添加PostMessage消息Post函数</div></pre></td></tr></table></figure>
<p>c. 使用事件CEvent类实现线程间通信。Event对象有两种状态：有信号和无信号，线程可以监视处于有信号状态的事件，以便在适当的时候执行对事件的操作。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">1)创建一个CEvent类的对象：CEvent threadStart;它默认处在未通信状态；</div><div class="line">2)threadStart.SetEvent();使其处于通信状态；</div><div class="line">3)调用WaitForSingleObject()来监视CEvent对象</div></pre></td></tr></table></figure>
<p>当线程间是可以共享资源时，线程间通信是协调它们的重要的手段。Object类中wait()notify()notifyAll()方法可以用于线程间通信关于资源的锁的状态。<a href="http://www.journaldev.com/1037/java-thread-wait-notify-and-notifyall-example" target="_blank" rel="external">Read more</a></p>
<h3 id="14-进程间通信方式及特点？"><a href="#14-进程间通信方式及特点？" class="headerlink" title="14. 进程间通信方式及特点？"></a>14. 进程间通信方式及特点？</h3><p>进程是转入内存并准备执行的程序，每个程序都有私有的虚拟地址空间，由代码，数据以及它可利用的系统资源(如文件，管道)组成。多进程/多线程是windows操作系统的一个基本特征。Linux系统一般都统称为进程。</p>
<p>由于不同的进程运行在各自不同的内存空间中，其中一个进程对于变量的修改另一方是无法感知的，因此，进程之间的消息传递不能通过变量或其他数据结构直接进行，只能通过进程间通信来完成。进程间通信是指<strong>不同进程间进行数据共享和数据交换</strong>。</p>
<p>进程间通信方式：<strong>文件和记录锁定，管道，有名管道，FIFO，信号量，信号，消息队列，共享内存，套接字</strong>。[^14] <a href="http://blog.csdn.net/chenhuajie123/article/details/9315477" target="_blank" rel="external">Read Read Read…</a></p>
<h3 id="15-为什么线程通信的方法wait-notify-和notifyAll-被定义在Object类里？"><a href="#15-为什么线程通信的方法wait-notify-和notifyAll-被定义在Object类里？" class="headerlink" title="15. 为什么线程通信的方法wait(), notify()和notifyAll()被定义在Object类里？"></a>15. 为什么线程通信的方法wait(), notify()和notifyAll()被定义在Object类里？</h3><p>Java的每个对象中都有一个锁(monitor，也可以成为监视器) 并且wait()，notify()等方法用于等待对象的锁或者通知其他线程对象的监视器可用。在Java的线程中并没有可供任何对象使用的锁和同步器。这就是为什么这些方法是Object类的一部分，这样Java的每一个类都有用于线程间通信的基本方法</p>
<h3 id="16-为什么wait-notify-和notifyAll-必须在同步方法或者同步块中被调用？"><a href="#16-为什么wait-notify-和notifyAll-必须在同步方法或者同步块中被调用？" class="headerlink" title="16. 为什么wait(), notify()和notifyAll()必须在同步方法或者同步块中被调用？"></a>16. 为什么wait(), notify()和notifyAll()必须在同步方法或者同步块中被调用？</h3><p>当一个线程需要调用对象的wait()方法的时候，这个线程必须拥有该对象的锁，接着它就会释放这个对象锁并进入等待状态直到其他线程调用这个对象上的notify()方法。同样的，当一个线程需要调用对象的notify()方法时，它会释放这个对象的锁，以便其他在等待的线程就可以得到这个对象锁。由于所有的这些方法都需要线程持有对象的锁，这样就只能通过同步来实现，所以他们只能在同步方法或者同步块中被调用。</p>
<h3 id="17-为什么Thread类的sleep-和yield-方法是静态的？"><a href="#17-为什么Thread类的sleep-和yield-方法是静态的？" class="headerlink" title="17. 为什么Thread类的sleep()和yield()方法是静态的？"></a>17. 为什么Thread类的sleep()和yield()方法是静态的？</h3><p>Thread类的sleep()和yield()方法将在当前正在执行的线程上运行。所以在其他处于等待状态的线程上调用这些方法是没有意义的。这就是为什么这些方法是静态的。它们可以在当前正在执行的线程中工作，并避免程序员错误的认为可以在其他非运行线程调用这些方法。</p>
<h3 id="18-如何确保线程安全？"><a href="#18-如何确保线程安全？" class="headerlink" title="18. 如何确保线程安全？"></a>18. 如何确保线程安全？</h3><p>在Java中可以有很多方法来保证线程安全——同步，使用原子类(atomic concurrent classes)，实现并发锁，使用volatile关键字，使用不变类和线程安全类。<a href="http://www.journaldev.com/1061/java-synchronization-and-thread-safety-tutorial-with-examples" target="_blank" rel="external">Read more</a></p>
<h3 id="19-volatile关键字在Java中有什么作用？"><a href="#19-volatile关键字在Java中有什么作用？" class="headerlink" title="19. volatile关键字在Java中有什么作用？"></a>19. volatile关键字在Java中有什么作用？</h3><p>当我们使用volatile关键字去修饰变量的时候，所以线程都会直接读取该变量并且不缓存它。这就确保了线程读取到的变量是同内存中是一致的。</p>
<h3 id="20-同步方法和同步块，哪个是更好的选择？"><a href="#20-同步方法和同步块，哪个是更好的选择？" class="headerlink" title="20. 同步方法和同步块，哪个是更好的选择？"></a>20. 同步方法和同步块，哪个是更好的选择？</h3><p>同步块是更好的选择，因为它不会锁住整个对象（当然你也可以让它锁住整个对象）。同步方法会锁住整个对象，哪怕这个类中有多个不相关联的同步块，这通常会导致他们停止执行并需要等待获得这个对象上的锁。</p>
<h3 id="21-如何创建守护线程？"><a href="#21-如何创建守护线程？" class="headerlink" title="21. 如何创建守护线程？"></a>21. 如何创建守护线程？</h3><p>使用Thread类的setDaemon(true)方法可以将线程设置为守护线程，需要注意的是，需要在调用start()方法前调用这个方法，否则会抛出IllegalThreadStateException异常。</p>
<h3 id="22-什么是ThreadLocal"><a href="#22-什么是ThreadLocal" class="headerlink" title="22. 什么是ThreadLocal?"></a>22. 什么是ThreadLocal?</h3><p>ThreadLocal用于创建线程的本地变量，我们知道一个对象的所有线程会共享它的全局变量，所以这些变量不是线程安全的，我们可以使用同步技术。但是当我们不想使用同步的时候，我们可以选择ThreadLocal变量。</p>
<p>每个线程都会拥有他们自己的Thread变量，它们可以使用get()set()方法去获取他们的默认值或者在线程内部改变他们的值。ThreadLocal实例通常是希望它们同线程状态关联起来是private static属性。<a href="http://www.journaldev.com/1076/java-threadlocal-example-to-create-thread-local-variables" target="_blank" rel="external">Read more</a>。</p>
<h3 id="23-什么是死锁-Deadlock-？如何避免死锁？"><a href="#23-什么是死锁-Deadlock-？如何避免死锁？" class="headerlink" title="23. 什么是死锁(Deadlock)？如何避免死锁？"></a>23. 什么是死锁(Deadlock)？如何避免死锁？</h3><p>死锁是指两个以上的线程永远阻塞的情况，这种情况产生至少需要两个以上的线程和两个以上的资源。死锁的四个必要条件：</p>
<ul>
<li><strong>互斥（Mutual exclusion）</strong>：存在这样一种资源，它在某个时刻只能被分配给一个执行绪（也称为线程）使用；</li>
<li><strong>持有（Hold and wait）</strong>：当请求的资源已被占用从而导致执行绪阻塞时，资源占用者不但无需释放该资源，而且还可以继续请求更多资源；</li>
<li><strong>不可剥夺（No preemption）</strong>：执行绪获得到的互斥资源不可被强行剥夺，换句话说，只有资源占用者自己才能释放资源；</li>
<li><strong>环形等待（Circular wait）</strong>：若干执行绪以不同的次序获取互斥资源，从而形成环形等待的局面，想象在由多个执行绪组成的环形链中，每个执行绪都在等待下一个执行绪释放它持有的资源。</li>
</ul>
<p>在系统中已经出现死锁后，应该及时检测到死锁的发生，并采取适当的措施来解除死锁。目前处理死锁的方法可归结为<a href="http://blog.csdn.net/joejames/article/details/37960873" target="_blank" rel="external">四种</a></p>
<h3 id="24-什么是线程池？如何创建一个Java线程池？"><a href="#24-什么是线程池？如何创建一个Java线程池？" class="headerlink" title="24. 什么是线程池？如何创建一个Java线程池？"></a>24. 什么是线程池？如何创建一个Java线程池？</h3><p>一个线程池管理了一组工作线程，同时它还包括了一个用于放置等待执行的任务的队列。</p>
<p>java.util.concurrent.Executors提供了一个java.util.concurrent.Executor接口的实现用于创建线程池。<a href="http://www.journaldev.com/1069/java-thread-pool-example-using-executors-and-threadpoolexecutor" target="_blank" rel="external">如何创建和使用线程池</a></p>
<h1 id="Java并发面试问题"><a href="#Java并发面试问题" class="headerlink" title="Java并发面试问题"></a>Java并发面试问题</h1><h3 id="1-什么是原子操作？在Java-Concurrency-API中有哪些原子类-atomic-classes-？"><a href="#1-什么是原子操作？在Java-Concurrency-API中有哪些原子类-atomic-classes-？" class="headerlink" title="1. 什么是原子操作？在Java Concurrency API中有哪些原子类(atomic classes)？"></a>1. 什么是原子操作？在Java Concurrency API中有哪些原子类(atomic classes)？</h3><p>原子操作是指一个不受其他操作影响的操作任务单元。原子操作是在多线程环境下避免数据不一致必须的手段。</p>
<p>int++并不是一个原子操作，所以当一个线程读取它的值并加1时，另外一个线程有可能会读到之前的值，这就会引发错误。</p>
<p>为了解决这个问题，必须保证增加操作是原子的，在JDK1.5之前我们可以使用同步技术来做到这一点。到JDK1.5，java.util.concurrent.atomic包提供了int和long类型的装类，它们可以自动的保证对于他们的操作是原子的并且不需要使用同步。<a href="http://www.journaldev.com/1069/java-thread-pool-example-using-executors-and-threadpoolexecutor" target="_blank" rel="external">Read more</a>。</p>
<h3 id="2-Java-Concurrency-API中的Lock接口-Lock-interface-是什么？对比同步它有什么优势？"><a href="#2-Java-Concurrency-API中的Lock接口-Lock-interface-是什么？对比同步它有什么优势？" class="headerlink" title="2. Java Concurrency API中的Lock接口(Lock interface)是什么？对比同步它有什么优势？"></a>2. Java Concurrency API中的Lock接口(Lock interface)是什么？对比同步它有什么优势？</h3><p>Lock接口比同步方法和同步块提供了更具扩展性的锁操作。他们允许更灵活的结构，可以具有完全不同的性质，并且可以支持多个相关类的条件对象。它的优势有：</p>
<ul>
<li>可以使锁更公平</li>
<li>可以使线程在等待锁的时候响应中断</li>
<li>可以让线程尝试获取锁，并在无法获取锁的时候立即返回或者等待一段时间</li>
<li>可以在不同的范围，以不同的顺序获取和释放锁</li>
</ul>
<h3 id="3-什么是Executors框架？"><a href="#3-什么是Executors框架？" class="headerlink" title="3. 什么是Executors框架？"></a>3. 什么是Executors框架？</h3><p>Executor框架同java.util.concurrent.Executor 接口在Java5中被引入。Executor框架是一个根据一组执行策略调用，调度，执行和控制的异步任务的框架。</p>
<p>无限制的创建线程会引起应用程序内存溢出。所以创建一个线程池是个更好的的解决方案，因为可以限制线程的数量并且可以回收再利用这些线程。利用Executors框架可以非常方便的创建一个线程池。<a href="http://www.journaldev.com/1069/java-thread-pool-example-using-executors-and-threadpoolexecutor" target="_blank" rel="external">Read more</a></p>
<h3 id="4-什么是阻塞队列？如何使用阻塞队列来实现生产者-消费者模型？"><a href="#4-什么是阻塞队列？如何使用阻塞队列来实现生产者-消费者模型？" class="headerlink" title="4. 什么是阻塞队列？如何使用阻塞队列来实现生产者-消费者模型？"></a>4. 什么是阻塞队列？如何使用阻塞队列来实现生产者-消费者模型？</h3><p>java.util.concurrent.BlockingQueue的特性是：当队列是空的时，从队列中获取或删除元素的操作将会被阻塞，或者当队列是满时，往队列里添加元素的操作会被阻塞。</p>
<p>阻塞队列不接受空值，当你尝试向队列中添加空值的时候，它会抛出NullPointerException。</p>
<p>阻塞队列的实现都是线程安全的，所有的查询方法都是原子的并且使用了内部锁或者其他形式的并发控制。</p>
<p>BlockingQueue接口是java collections框架的一部分，它主要用于实现生产者-消费者问题。<a href="http://www.journaldev.com/1034/java-blockingqueue-example-implementing-producer-consumer-problem" target="_blank" rel="external">使用阻塞队列实现生产者-消费者问题</a>。</p>
<h3 id="5-什么是并发容器的实现？"><a href="#5-什么是并发容器的实现？" class="headerlink" title="5. 什么是并发容器的实现？"></a>5. 什么是并发容器的实现？</h3><p>Java集合类都是快速失败的，这就意味着当集合被改变且一个线程在使用迭代器遍历集合的时候，迭代器的next()方法将抛出ConcurrentModificationException异常。</p>
<p>并发容器支持并发的遍历和并发的更新。</p>
<p>主要的类有ConcurrentHashMap, CopyOnWriteArrayList 和CopyOnWriteArraySet。</p>
<h3 id="6-Executors类是什么？"><a href="#6-Executors类是什么？" class="headerlink" title="6. Executors类是什么？"></a>6. Executors类是什么？</h3><p>Executors为Executor，ExecutorService，ScheduledExecutorService，ThreadFactory和Callable类提供了一些工具方法。</p>
<p>Executors可以用于方便的创建线程池。</p>
<h1 id="好文推荐"><a href="#好文推荐" class="headerlink" title="好文推荐"></a>好文推荐</h1><h3 id="秒杀多线程面试题系列"><a href="#秒杀多线程面试题系列" class="headerlink" title="秒杀多线程面试题系列"></a><a href="http://blog.csdn.net/column/details/killthreadseries.html" target="_blank" rel="external">秒杀多线程面试题系列</a></h3><h3 id="进程通信方式及特点"><a href="#进程通信方式及特点" class="headerlink" title="进程通信方式及特点"></a><a href="http://blog.csdn.net/chenhuajie123/article/details/9315477" target="_blank" rel="external">进程通信方式及特点</a></h3><hr>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://agehua.github.io/2015/03/16/java-multithreading-concurrent/" data-id="ciw6b0ajt0002i6fybgb7juu3" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://agehua.github.io/2015/03/16/java-multithreading-concurrent/#comments" class="article-comment-link ds-thread-count" data-thread-key="http://agehua.github.io/2015/03/16/java-multithreading-concurrent/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/12/01/2016-11-3-hexo-mac-module-not-found/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/accumulation/">accumulation</a></p>
                            <p class="item-title"><a href="/2016/12/01/2016-11-3-hexo-mac-module-not-found/" class="title">Hexo 出错情况收集</a></p>
                            <p class="item-date"><time datetime="2016-12-01T01:30:27.000Z" itemprop="datePublished">2016-12-01</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/10/13/gradle-learning2/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/accumulation/">accumulation</a></p>
                            <p class="item-title"><a href="/2016/10/13/gradle-learning2/" class="title">gradle 学习2——生成指定文件名的apk</a></p>
                            <p class="item-date"><time datetime="2016-10-12T16:00:00.000Z" itemprop="datePublished">2016-10-13</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/10/12/gradle-learning/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/accumulation/">accumulation</a></p>
                            <p class="item-title"><a href="/2016/10/12/gradle-learning/" class="title">gradle 学习</a></p>
                            <p class="item-date"><time datetime="2016-10-11T16:00:00.000Z" itemprop="datePublished">2016-10-12</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/09/28/Android-interview-questions/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/accumulation/">accumulation</a></p>
                            <p class="item-title"><a href="/2016/09/28/Android-interview-questions/" class="title">Android面试知识点整理</a></p>
                            <p class="item-date"><time datetime="2016-09-27T16:00:00.000Z" itemprop="datePublished">2016-09-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2016/09/22/JNI-get-publickey/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/technology/">technology</a></p>
                            <p class="item-title"><a href="/2016/09/22/JNI-get-publickey/" class="title">使用JNI获取publickey实现</a></p>
                            <p class="item-date"><time datetime="2016-09-21T16:00:00.000Z" itemprop="datePublished">2016-09-22</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/accumulation/">accumulation</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/read/">read</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/technology/">technology</a><span class="category-list-count">7</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-jni/">Android JNI</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-design-pattern/">Android design pattern</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rxjava/">RxJava</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/accumulation/">accumulation</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/">gradle</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/read/">read</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/technology/">technology</a><span class="tag-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/android-jni/" style="font-size: 16.67px;">Android JNI</a> <a href="/tags/android-design-pattern/" style="font-size: 10px;">Android design pattern</a> <a href="/tags/rxjava/" style="font-size: 10px;">RxJava</a> <a href="/tags/accumulation/" style="font-size: 20px;">accumulation</a> <a href="/tags/gradle/" style="font-size: 16.67px;">gradle</a> <a href="/tags/read/" style="font-size: 13.33px;">read</a> <a href="/tags/technology/" style="font-size: 16.67px;">technology</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
                    <li>
                        <a href="http://www.bigademo.com">ghost老司机的博客</a>
                    </li>
                
                    <li>
                        <a href="http://www.5come.cn">我的ghost博客</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2016 Jixin Li<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'agehua'};
    (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>



    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>