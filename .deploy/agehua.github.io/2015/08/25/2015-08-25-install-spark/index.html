<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="马浩珍在 Github 上的个人博客">
    <meta name="keyword" content="null">
    <meta name="theme-color" content="#600090">
    <meta name="msapplication-navbutton-color" content="#600090">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#600090">
    <link rel="shortcut icon" href="https://cdn4.iconfinder.com/data/icons/ionicons/512/icon-person-128.png">
    <link rel="alternate" type="application/atom+xml" title="Haojen" href="/atom.xml">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css">
    <title>
        
        Install spark｜Haojen&#39;s blog
        
    </title>

    <link rel="canonical" href="http://agehua.github.io/2015/08/25/2015-08-25-install-spark/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/blog-style.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
</head>

<style>

    header.intro-header {
        background-image: url('//o7bkkhiex.bkt.clouddn.com/lion-blur-bg.jpg')
    }
</style>
<!-- hack iOS CSS :active style -->
<body ontouchstart="" class="animated fadeIn">
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top " id="nav-top" data-ispost = "true" data-istags="false
" data-ishome = "false" >
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand animated pulse" href="/">
                <span class="brand-logo">
                    Haojen
                </span>
                's Blog
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <!-- /.navbar-collapse -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
					
                    
                        
                    
					
					
                </ul>
            </div>
        </div>
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
//    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>

<!-- Main Content -->

<!--only post-->


<img class="wechat-title-img"
     src="">


<style>
    
    header.intro-header {
        background-image: url('')
    }

    
</style>

<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <div class="post-heading">
                    <h1>Install spark</h1>
                    
                    <span class="meta">
                         作者 Haojen Ma
                        <span>
                          日期 2015-08-25
                         </span>
                    </span>
                    <div class="tags text-center">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="post-title-haojen">
        <span>
            Install spark
        </span>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container">
                <p>前面一片文章<a href="/2015/08/24/install-hadoop/">install hadoop</a>介绍了hadoop的安装，这一片安装spark的文章，就是在hadoop已经安装好的基础上进行的。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>下载<a href="http://spark.apache.org/downloads.html" target="_blank" rel="external">spark</a></p>
<p>hadoop的版本为2.7.1，下载的是spark-1.4.1-bin-hadoop2.6.tgz。</p>
<p>这里下载是已经编译好的，也可以下载源码，自己编译。</p>
<a id="more"></a>
<h2 id="配置spark"><a href="#配置spark" class="headerlink" title="配置spark"></a>配置spark</h2><p>本章节的内容都是在master操作。</p>
<p>解压spark-1.4.1-bin-hadoop2.6.tgz，移至<code>/usr/</code>目录下<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">mv spark-1.4.1-bin-hadoop2.6 /usr/spark-1.4.1</div></pre></td></tr></table></figure></p>
<ol>
<li><p>配置spark-env.sh<br>在目录<code>${SPARK_HOME}/conf</code>中，将<code>spark-env.sh.template</code>拷贝为<code>spark-env.sh</code>，添加以下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk</div><div class="line">export SPARK_DIST_CLASSPATH=$(/usr/hadoop/bin/hadoop classpath)</div></pre></td></tr></table></figure>
</li>
<li><p>配置spark-defaults.conf<br>在目录<code>${SPARK_HOME}/conf</code>中，将<code>spark-defaults.conf.template</code>拷贝为<code>spark-defaults.conf</code>，修改以下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># Example:</div><div class="line">spark.master                     spark://master.hadoop:7077</div><div class="line"># spark.eventLog.enabled           true</div><div class="line"># spark.eventLog.dir               hdfs://namenode:8021/directory</div><div class="line"># spark.serializer                 org.apache.spark.serializer.KryoSerializer</div><div class="line">spark.driver.memory              500m</div><div class="line"># spark.executor.extraJavaOptions  -XX:+PrintGCDetails -Dkey=value -Dnumbers=&quot;one two three&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>配置slaves文件<br>在目录<code>${SPARK_HOME}/conf</code>中，将<code>slaves.template</code>拷贝为<code>slaves</code>，修改以下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">slave1.hadoop</div><div class="line">slave2.hadoop</div></pre></td></tr></table></figure>
</li>
<li><p>修改/etc/profile</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># set spark path</div><div class="line">export SPARK_HOME=/usr/spark-1.4.1</div><div class="line">export SPARK_MASTER_IP=master.hadoop</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="拷贝到slave节点"><a href="#拷贝到slave节点" class="headerlink" title="拷贝到slave节点"></a>拷贝到slave节点</h2><p>在master上操作完成后，需要将spark-1.4.1的目录拷贝到所有的slave节点上。<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">scp -r spark-1.4.1 slave2.hadoop:/usr/</div></pre></td></tr></table></figure></p>
<p>然后将<code>/etc/profile</code>拷贝到slave节点上。<br>或者在profile文件中添加配置<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># set spark path</div><div class="line">export SPARK_HOME=/usr/spark-1.4.1</div><div class="line">export SPARK_MASTER_IP=master.hadoop</div></pre></td></tr></table></figure></p>
<h2 id="启动spark"><a href="#启动spark" class="headerlink" title="启动spark"></a>启动spark</h2><p>启动了hadoop以后，可以通过下面的命令启动spark<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$&#123;SPARK_HOME&#125;/sbin/start-all.sh</div></pre></td></tr></table></figure></p>
<h2 id="验证安装情况"><a href="#验证安装情况" class="headerlink" title="验证安装情况"></a>验证安装情况</h2><ol>
<li><p>运行自带示例<br>$ bin/run-example  org.apache.spark.examples.SparkPi</p>
</li>
<li><p>查看集群环境<br><a href="http://master:8080/" target="_blank" rel="external">http://master:8080/</a></p>
</li>
<li><p>进入spark-shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$&#123;SPARK_HOME&#125;/bin/spark-shell</div></pre></td></tr></table></figure>
</li>
<li><p>查看sparkContext等信息</p>
</li>
</ol>
<p>当spark运行的时候，每一个SparkContext都会启动一个web UI, 默认的端口为4040，通这个端口，可以查看一些关于这个应用非常有用的信息。<br>包括一下信息：</p>
<ul>
<li>A list of scheduler stages and tasks</li>
<li>A summary of RDD sizes and memory usage</li>
<li>Environmental information.</li>
<li>Information about the running executors</li>
</ul>
<p>所以第一个SparkContext，可以通过下面的网址产看job信息</p>
<p><a href="http://master:4040/jobs/" target="_blank" rel="external">http://master:4040/jobs/</a></p>
<p>当有多个sparkcontext在同一个host上运行的时候，他们将顺序绑定4040自后的端口，例如（4041,4042等等)</p>
<h2 id="查看sparkcontext的history信息"><a href="#查看sparkcontext的history信息" class="headerlink" title="查看sparkcontext的history信息"></a>查看sparkcontext的history信息</h2><p>Note that this information is only available for the duration of the application by default. To view the web UI after the fact, set spark.eventLog.enabled to true before starting the application. This configures Spark to log Spark events that encode the information displayed in the UI to persisted storage.</p>
<p>When using the file-system provider class (see spark.history.provider below), the base logging directory must be supplied in the spark.history.fs.logDirectory configuration option,</p>
<p>in the <code>/spark/conf/spark-defaults.conf</code> add:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">spark.eventLog.enabled           true</div><div class="line">spark.eventLog.dir               hdfs://hadoop:9000/spark/event_log</div><div class="line">spark.history.fs.logDirectory      hdfs://hadoop:9000/spark/log_directory</div></pre></td></tr></table></figure>
<p>注意：spark.eventLog.dir要与spark.history.fs.logDirectory要是一致的。</p>
<p>then go to the <code>sbin</code> directory:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">./start-history-server.sh</div></pre></td></tr></table></figure></p>
<p>then can open spark history on port 18080:<br><a href="http://spark-host:18080/" target="_blank" rel="external">http://spark-host:18080/</a></p>
<p>更多信息可以参考：<a href="http://spark.apache.org/docs/latest/monitoring.html" target="_blank" rel="external">spark Monitoring and Instrumentation</a></p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="">http://blog.csdn.net/jediael_lu/article/details/45310321</a></p>

                <hr>
                

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2015/08/26/2015-08-26-install-zookeeper/" data-toggle="tooltip" data-placement="top"
                           title="Install zookeeper">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2015/08/24/2015-08-24-install-hadoop/" data-toggle="tooltip" data-placement="top"
                           title="Install hadoop">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                

                

            </div>

            <div class="hidden-xs col-sm-3 toc-col">
                <div class="toc-wrap">
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备"><span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置spark"><span class="toc-text">配置spark</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拷贝到slave节点"><span class="toc-text">拷贝到slave节点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动spark"><span class="toc-text">启动spark</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#验证安装情况"><span class="toc-text">验证安装情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查看sparkcontext的history信息"><span class="toc-text">查看sparkcontext的history信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reference"><span class="toc-text">reference</span></a></li></ol>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5 class="text-center">
                        <a href="/tags/">FEATURED TAGS</a>
                    </h5>
                    <div class="tags">
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>

    </div>
</article>






<!-- Footer -->
<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center">
                <br>
                <ul class="list-inline text-center">
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/agehua">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/agehua">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/agehua">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Haojen 2016
                    <br>
                    <span id="busuanzi_container_site_pv" style="font-size: 12px;">PV: <span id="busuanzi_value_site_pv"></span> Times</span>
                    <br>
                    Theme by <a href="https://haojen.github.io/">Haojen Ma</a>
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/blog.js"></script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://agehua.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Google Analytics -->



<!-- Baidu Tongji -->


<!-- swiftype -->
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','null','2.0.0');
</script>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!--wechat title img-->
<img class="wechat-title-img" src="null">
</body>

</html>
